{"./":{"url":"./","title":"å‰è¨€","keywords":"","body":" å‰è¨€ å‰è¨€ https://www.elastic.co/cn/elasticsearch Elasticsearch æ˜¯ä¸€ä¸ªåŸºäº Apache Lucene æ„å»ºçš„å¼€æºæœç´¢å’Œåˆ†æå¼•æ“ï¼Œå®ƒä¸“æ³¨äºå®æ—¶æ•°æ®çš„å­˜å‚¨ã€æ£€ç´¢å’Œåˆ†æã€‚Elasticsearch è¢«è®¾è®¡æˆå¯æ°´å¹³æ‰©å±•ï¼Œèƒ½å¤Ÿå¤„ç†å¤§è§„æ¨¡æ•°æ®å¹¶æä¾›å¿«é€Ÿçš„æ£€ç´¢å’Œåˆ†æèƒ½åŠ›ã€‚å®ƒé€šå¸¸ç”¨äºæ—¥å¿—å’Œäº‹ä»¶æ•°æ®åˆ†æã€å…¨æ–‡æœç´¢ä»¥åŠå…¶ä»–éœ€è¦å¿«é€Ÿå’Œçµæ´»æœç´¢èƒ½åŠ›çš„åœºæ™¯ã€‚Elasticsearch æä¾›ä¸°å¯Œçš„ APIï¼Œç”¨äºç´¢å¼•å’ŒæŸ¥è¯¢æ•°æ®ï¼Œå› æ­¤å—åˆ°äº†å¼€å‘äººå‘˜å’Œå¤„ç†å¤§å‹æ•°æ®é›†çš„ç»„ç»‡çš„æ¬¢è¿ã€‚ Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€é«˜æ‰©å±•ã€é«˜å®æ—¶çš„æœç´¢ä¸æ•°æ®åˆ†æå¼•æ“ã€‚å®ƒèƒ½å¾ˆæ–¹ä¾¿çš„ä½¿å¤§é‡æ•°æ®å…·æœ‰æœç´¢ã€åˆ†æå’Œæ¢ç´¢çš„èƒ½åŠ›ã€‚å……åˆ†åˆ©ç”¨Elasticsearchçš„æ°´å¹³ä¼¸ç¼©æ€§ï¼Œèƒ½ä½¿æ•°æ®åœ¨ç”Ÿäº§ç¯å¢ƒå˜å¾—æ›´æœ‰ä»·å€¼ã€‚Elasticsearch çš„å®ç°åŸç†ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼Œé¦–å…ˆç”¨æˆ·å°†æ•°æ®æäº¤åˆ°Elasticsearch æ•°æ®åº“ä¸­ï¼Œå†é€šè¿‡åˆ†è¯æ§åˆ¶å™¨å»å°†å¯¹åº”çš„è¯­å¥åˆ†è¯ï¼Œå°†å…¶æƒé‡å’Œåˆ†è¯ç»“æœä¸€å¹¶å­˜å…¥æ•°æ®ï¼Œå½“ç”¨æˆ·æœç´¢æ•°æ®æ—¶å€™ï¼Œå†æ ¹æ®æƒé‡å°†ç»“æœæ’åï¼Œæ‰“åˆ†ï¼Œå†å°†è¿”å›ç»“æœå‘ˆç°ç»™ç”¨æˆ·ã€‚ Elasticsearchæ˜¯ä¸åä¸ºLogstashçš„æ•°æ®æ”¶é›†å’Œæ—¥å¿—è§£æå¼•æ“ä»¥åŠåä¸ºKibanaçš„åˆ†æå’Œå¯è§†åŒ–å¹³å°ä¸€èµ·å¼€å‘çš„ã€‚è¿™ä¸‰ä¸ªäº§å“è¢«è®¾è®¡æˆä¸€ä¸ªé›†æˆè§£å†³æ–¹æ¡ˆï¼Œç§°ä¸ºâ€œElastic Stackâ€ï¼ˆä»¥å‰ç§°ä¸ºâ€œELK stackâ€ï¼‰ã€‚ Elasticsearchå¯ä»¥ç”¨äºæœç´¢å„ç§æ–‡æ¡£ã€‚å®ƒæä¾›å¯æ‰©å±•çš„æœç´¢ï¼Œå…·æœ‰æ¥è¿‘å®æ—¶çš„æœç´¢ï¼Œå¹¶æ”¯æŒå¤šç§Ÿæˆ·ã€‚Elasticsearchæ˜¯åˆ†å¸ƒå¼çš„ï¼Œè¿™æ„å‘³ç€ç´¢å¼•å¯ä»¥è¢«åˆ†æˆåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡å¯ä»¥æœ‰0ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬ã€‚æ¯ä¸ªèŠ‚ç‚¹æ‰˜ç®¡ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç‰‡ï¼Œå¹¶å……å½“åè°ƒå™¨å°†æ“ä½œå§”æ‰˜ç»™æ­£ç¡®çš„åˆ†ç‰‡ã€‚å†å¹³è¡¡å’Œè·¯ç”±æ˜¯è‡ªåŠ¨å®Œæˆçš„ã€‚ç›¸å…³æ•°æ®é€šå¸¸å­˜å‚¨åœ¨åŒä¸€ä¸ªç´¢å¼•ä¸­ï¼Œè¯¥ç´¢å¼•ç”±ä¸€ä¸ªæˆ–å¤šä¸ªä¸»åˆ†ç‰‡å’Œé›¶ä¸ªæˆ–å¤šä¸ªå¤åˆ¶åˆ†ç‰‡ç»„æˆã€‚ä¸€æ—¦åˆ›å»ºäº†ç´¢å¼•ï¼Œå°±ä¸èƒ½æ›´æ”¹ä¸»åˆ†ç‰‡çš„æ•°é‡ã€‚ Elasticsearchä½¿ç”¨Luceneï¼Œå¹¶è¯•å›¾é€šè¿‡JSONå’ŒJava APIæä¾›å…¶æ‰€æœ‰ç‰¹æ€§ã€‚å®ƒæ”¯æŒfacettingå’Œpercolatingï¼Œå¦‚æœæ–°æ–‡æ¡£ä¸æ³¨å†ŒæŸ¥è¯¢åŒ¹é…ï¼Œè¿™å¯¹äºé€šçŸ¥éå¸¸æœ‰ç”¨ã€‚å¦ä¸€ä¸ªç‰¹æ€§ç§°ä¸ºâ€œç½‘å…³â€ï¼Œå¤„ç†ç´¢å¼•çš„é•¿æœŸæŒä¹…æ€§ï¼›ä¾‹å¦‚ï¼Œåœ¨æœåŠ¡å™¨å´©æºƒçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä»ç½‘å…³æ¢å¤ç´¢å¼•ã€‚Elasticsearchæ”¯æŒå®æ—¶GETè¯·æ±‚ï¼Œé€‚åˆä½œä¸ºNoSQLæ•°æ®å­˜å‚¨ï¼Œä½†ç¼ºå°‘åˆ†å¸ƒå¼äº‹åŠ¡ã€‚ å¼ºå¤§çš„æœç´¢èƒ½åŠ›ï¼š Elasticsearch åŸºäº Lucene æ„å»ºï¼Œæä¾›äº†å¼ºå¤§çš„å…¨æ–‡æœç´¢åŠŸèƒ½ï¼Œæ”¯æŒå¤æ‚çš„æŸ¥è¯¢å’Œåˆ†æã€‚ å®æ—¶æ€§èƒ½ï¼š Elasticsearch æä¾›äº†å¿«é€Ÿçš„å®æ—¶æŸ¥è¯¢å’Œåˆ†æèƒ½åŠ›ï¼Œé€‚ç”¨äºéœ€è¦å³æ—¶åé¦ˆçš„åº”ç”¨åœºæ™¯ã€‚ å¯æ‰©å±•æ€§ï¼š Elasticsearch èƒ½å¤Ÿè½»æ¾åœ°æ°´å¹³æ‰©å±•ï¼Œå¯ä»¥å¤„ç†å¤§è§„æ¨¡çš„æ•°æ®é›†ã€‚ å¼€å‘å‹å¥½ï¼š Elasticsearch æä¾›äº†ç®€å•æ˜“ç”¨çš„ RESTful APIï¼Œæ–¹ä¾¿å¼€å‘äººå‘˜è¿›è¡Œæ•°æ®çš„ç´¢å¼•ã€æŸ¥è¯¢å’Œç®¡ç†ã€‚ ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿï¼š Elasticsearch ç”Ÿæ€ç³»ç»ŸåŒ…æ‹¬äº†å„ç§æ’ä»¶å’Œå·¥å…·ï¼Œæ”¯æŒå¤šç§æ•°æ®æºçš„é›†æˆå’Œæ•°æ®å¤„ç†ã€‚ å¤šåŠŸèƒ½æ€§ï¼š Elasticsearch ä¸ä»…ä»…ç”¨äºæœç´¢å’Œåˆ†æï¼Œè¿˜å¯ä»¥ç”¨ä½œæ—¥å¿—æ”¶é›†ã€ç›‘æ§æ•°æ®åˆ†æã€å®æ—¶æ¨èç­‰å¤šç§ç”¨é€”ã€‚ console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"es-jie-shao.html":{"url":"es-jie-shao.html","title":"ESä»‹ç»","keywords":"","body":" ESä»‹ç»1. ESåŠŸèƒ½ç‰¹ç‚¹ 1.1. ESæ˜¯ä»€ä¹ˆ 1.2. ESä¸»è¦åŠŸèƒ½ 2. ESä¸»è¦ç‰¹ç‚¹ 2.1. åˆ†ç‰‡ä¸é›†ç¾¤ 2.2. è‡ªåŠ¨ç´¢å¼• 2.3. æœç´¢æ˜¯è¿‘å®æ—¶çš„ 2.4. ESä¼˜ç¼ºç‚¹ 3. ESæ ¸å¿ƒæ¦‚å¿µ 3.1. ç´¢å¼•ï¼ˆindexï¼‰åº“ 3.2. ç±»å‹ï¼ˆtypeï¼‰è¡¨ 3.3. æ–‡æ¡£ï¼ˆdocumentï¼‰è¡Œ 3.4. Lucene Index 3.5. æ®µï¼ˆSegmentï¼‰ 3.6. æäº¤ç‚¹ï¼ˆcommit pointï¼‰ 3.7. æ˜ å°„ 3.8. Shard åˆ†ç‰‡ 3.9. Replica å‰¯æœ¬ 3.10. Clusteré›†ç¾¤ 3.11. NodeèŠ‚ç‚¹ 4. ESä½¿ç”¨ 4.1. åˆ†ç‰‡çš„è®¾å®š 4.2. ESæ•°æ®è¿‘å®æ—¶é—®é¢˜ ESä»‹ç» 1. ESåŠŸèƒ½ç‰¹ç‚¹ 1.1. ESæ˜¯ä»€ä¹ˆ ç‰¹ç‚¹: éå…³ç³»å‹ã€æœç´¢å¼•æ“ã€è¿‘å®æ—¶æœç´¢ä¸åˆ†æã€é«˜å¯ç”¨ã€å¤©ç„¶åˆ†å¸ƒå¼ã€æ¨ªå‘å¯æ‰©å±• ESæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€å¯æ‰©å±•ã€å®æ—¶çš„æœç´¢ä¸æ•°æ®åˆ†æå¼•æ“ ESä¸ä»…ä»…åªæ˜¯å…¨æ–‡æœç´¢ï¼Œè¿˜æ”¯æŒç»“æ„åŒ–æœç´¢ã€æ•°æ®åˆ†æã€å¤æ‚çš„è¯­è¨€å¤„ç†ã€åœ°ç†ä½ç½®å’Œå¯¹è±¡é—´å…³è”å…³ç³»ç­‰ ESçš„åº•å±‚ä¾èµ–Luceneï¼ŒLuceneå¯ä»¥è¯´æ˜¯å½“ä¸‹æœ€å…ˆè¿›ã€é«˜æ€§èƒ½ã€å…¨åŠŸèƒ½çš„æœç´¢å¼•æ“åº“ ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨Luceneï¼Ÿ ä½†æ˜¯Luceneä»…ä»…åªæ˜¯ä¸€ä¸ªåº“ï¼Œä½ éœ€è¦ä½¿ç”¨Javaå¹¶å°†Luceneç›´æ¥é›†æˆåˆ°åº”ç”¨ç¨‹åºä¸­ æ‚¨å¯èƒ½éœ€è¦è·å¾—ä¿¡æ¯æ£€ç´¢å­¦ä½æ‰èƒ½äº†è§£å…¶å·¥ä½œåŸç†ï¼Œå› ä¸ºLuceneéå¸¸å¤æ‚ ESä¹Ÿæ˜¯ä½¿ç”¨Javaç¼–å†™çš„ï¼Œå®ƒçš„å†…éƒ¨ä½¿ç”¨Luceneåšç´¢å¼•ä¸æœç´¢ å®ƒçš„ç›®çš„æ˜¯éšè—Luceneçš„å¤æ‚æ€§ï¼Œå–è€Œä»£ä¹‹çš„æä¾›ä¸€å¥—ç®€å•ä¸€è‡´çš„RESTful API 1.2. ESä¸»è¦åŠŸèƒ½ åˆ†å¸ƒå¼å®æ—¶æ–‡ä»¶å­˜å‚¨ï¼Œå¤„ç†çš„ç»“æ„åŒ–å’Œéç»“æ„æ•°æ® å®æ—¶åˆ†æçš„åˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œä¸ºç”¨æˆ·æä¾›å…³é”®å­—æŸ¥è¯¢çš„å…¨æ–‡æ£€ç´¢åŠŸèƒ½ æ˜¯å®ç°ä¼ä¸šçº§PBçº§æµ·é‡æ•°æ®å¤„ç†åˆ†æçš„å¤§æ•°æ®è§£å†³æ–¹æ¡ˆï¼ˆELKï¼‰ ESä¸»è¦è‡´åŠ›äºç»“æ„åŒ–å’Œéç»“æ„åŒ–æ•°æ®çš„åˆ†å¸ƒå¼å®æ—¶å…¨æ–‡æœç´¢åŠåˆ†æï¼Œä½¿ç”¨åœºæ™¯ æ—¥å¿—ç®¡ç†ä¸åˆ†æï¼ˆELKï¼‰ ç³»ç»ŸæŒ‡æ ‡åˆ†æ å®‰å…¨åˆ†æ ä¼ä¸šæœç´¢ï¼ˆOAã€CRMã€ERPï¼‰ ç½‘ç«™æœç´¢ï¼ˆç”µå•†ã€æ‹›è˜ã€é—¨æˆ·ï¼‰ åº”ç”¨æœç´¢ åº”ç”¨æ€§èƒ½ç®¡ç†APM 2. ESä¸»è¦ç‰¹ç‚¹ 2.1. åˆ†ç‰‡ä¸é›†ç¾¤ ESé»˜è®¤æŠŠæ•°æ®åˆ†æˆå¤šä¸ªç‰‡ï¼Œå¤šä¸ªç‰‡å¯ä»¥ç»„æˆä¸€ä¸ªå®Œæ•´çš„æ•°æ®ï¼Œè¿™äº›ç‰‡å¯ä»¥åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­çš„å„ä¸ªæœºå™¨èŠ‚ç‚¹ä¸­ éšç€åæœŸæ•°æ®çš„è¶Šæ¥è¶Šå¤§ï¼ŒESé›†ç¾¤å¯ä»¥å¢åŠ å¤šä¸ªåˆ†ç‰‡ï¼ŒæŠŠå¤šä¸ªåˆ†ç‰‡åˆ†æ•£åˆ°æ›´å¤šçš„ä¸»æœºèŠ‚ç‚¹ä¸Š ESé›†ç¾¤å¯ä»¥å¢åŠ å¤šä¸ªåˆ†ç‰‡ï¼ŒæŠŠå¤šä¸ªåˆ†ç‰‡åˆ†æ•£åˆ°æ›´å¤šçš„æœºå™¨ä¸»æœºèŠ‚ç‚¹ä¸Šï¼Œè´Ÿè´£è´Ÿè½½å‡è¡¡ï¼Œæ¨ªå‘æ‰©å±• è€Œæ¯ä¸ªæŸ¥è¯¢ä»»åŠ¡æäº¤åˆ°æŸä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å¿…é¡»è´Ÿè´£å°†æ•°æ®è¿›è¡Œæ•´ç†æ±‡èšï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ 2.2. è‡ªåŠ¨ç´¢å¼• ESæ‰€æœ‰æ•°æ®é»˜è®¤éƒ½æ˜¯ç´¢å¼•çš„ ESåªæœ‰ä¸åŠ ç´¢å¼•æ‰éœ€è¦é¢å¤–å¤„ç† 2.3. æœç´¢æ˜¯è¿‘å®æ—¶çš„ ä½ å¾€ es é‡Œå†™çš„æ•°æ®ï¼Œå®é™…ä¸Šéƒ½å†™åˆ°ç£ç›˜æ–‡ä»¶é‡Œå»äº† æŸ¥è¯¢çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†ç£ç›˜æ–‡ä»¶é‡Œçš„æ•°æ®è‡ªåŠ¨ç¼“å­˜åˆ° filesystem cache é‡Œé¢å»ã€‚ es çš„æœç´¢å¼•æ“ä¸¥é‡ä¾èµ–äºåº•å±‚çš„ filesystem cacheï¼Œä½ å¦‚æœç»™ filesystem cache æ›´å¤šçš„å†…å­˜ å°½é‡è®©å†…å­˜å¯ä»¥å®¹çº³æ‰€æœ‰çš„idx segment fileç´¢å¼•æ•°æ®æ–‡ä»¶ï¼Œé‚£ä¹ˆä½ æœç´¢çš„æ—¶å€™å°±åŸºæœ¬éƒ½æ˜¯èµ°å†…å­˜çš„ï¼Œæ€§èƒ½ä¼šéå¸¸é«˜ã€‚ æ€§èƒ½å·®è·ç©¶ç«Ÿå¯ä»¥æœ‰å¤šå¤§ï¼Ÿæˆ‘ä»¬ä¹‹å‰å¾ˆå¤šçš„æµ‹è¯•å’Œå‹æµ‹ï¼š å¦‚æœèµ°ç£ç›˜ä¸€èˆ¬è‚¯å®šä¸Šç§’ï¼Œæœç´¢æ€§èƒ½ç»å¯¹æ˜¯ç§’çº§åˆ«çš„ï¼Œ1ç§’ã€5ç§’ã€10ç§’ã€‚ ä½†å¦‚æœæ˜¯èµ° filesystem cacheï¼Œæ˜¯èµ°çº¯å†…å­˜çš„ï¼Œé‚£ä¹ˆä¸€èˆ¬æ¥è¯´æ€§èƒ½æ¯”èµ°ç£ç›˜è¦é«˜ä¸€ä¸ªæ•°é‡çº§ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æ¯«ç§’çº§çš„ï¼Œä»å‡ æ¯«ç§’åˆ°å‡ ç™¾æ¯«ç§’ä¸ç­‰ã€‚ 2.4. ESä¼˜ç¼ºç‚¹ 3. ESæ ¸å¿ƒæ¦‚å¿µ mysql elasticsearch æ•°æ®åº“ï¼ˆDatebaseï¼‰ ç´¢å¼•ï¼ˆIndexï¼‰ è¡¨ï¼ˆTableï¼‰ ç±»å‹ï¼ˆTypeï¼‰ è¡Œï¼ˆRowï¼‰æ¯ä¸€æ¡ æ–‡æ¡£ï¼ˆDocumentï¼‰æ¯ä¸€æ¡ å­—æ®µ å±æ€§ å¯¹è±¡ï¼ˆSchemaï¼‰ æ˜ å°„ï¼ˆMappingï¼‰ ç´¢å¼•ï¼ˆIndexï¼‰ ä¸‡ç‰©çš†ç´¢å¼•ï¼ˆä¸ç®¡ä»€ä¹ˆæ•°æ®éƒ½é»˜è®¤ç´¢å¼•ï¼‰ SQLè¯­è¨€ï¼ˆSelectã€updateï¼‰ Query DSLï¼ˆGETã€PUTï¼‰ 3.1. ç´¢å¼•ï¼ˆindexï¼‰åº“ ESå°†ä»–çš„æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªç´¢å¼•ä¸­ï¼Œå¯ä»¥å‘ç´¢å¼•è¯»å†™æ–‡æ¡£ ç´¢å¼•ç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸€ä¸ªæ•°æ®åº“ 3.2. ç±»å‹ï¼ˆtypeï¼‰è¡¨ ç±»å‹ï¼ˆtypeï¼‰æ˜¯ç”¨æ¥è§„å®šæ–‡æ¡£çš„å„ä¸ªå­—æ®µå†…å®¹çš„æ•°æ®ç±»å‹å’Œå…¶ä»–çš„ä¸€äº›çº¦æŸ ä¸€ä¸ªç´¢å¼•ï¼ˆindexï¼‰å¯ä»¥æœ‰å¤šä¸ªæ–‡æ¡£ç±»å‹ï¼ˆtypeï¼‰ æ–‡æ¡£ç±»å‹ï¼ˆtypeï¼‰ç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ 3.3. æ–‡æ¡£ï¼ˆdocumentï¼‰è¡Œ åœ¨ESä¸­ï¼Œæ–‡æ¡£ï¼ˆdocumentï¼‰æ˜¯å­˜å‚¨æ•°æ®åº“çš„è½½ä½“ï¼ŒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µ ESä¸­çš„æœ€å°çš„ï¼Œæ•´ä½“çš„æ•°æ®å•ä½ æ–‡æ¡£ï¼ˆdocumentï¼‰ç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸€è¡Œæ•°æ® ä¸€ä¸ªdocumenté‡Œé¢æœ‰å¤šä¸ªfieldï¼Œæ¯ä¸ªfieldå°±æ˜¯ä¸€ä¸ªæ•°æ®å­—æ®µ 3.4. Lucene Index æ³¨æ„å’ŒES IndexåŒºåˆ«ï¼ŒLucene Indexæ˜¯ç”±è‹¥å¹²æ®µå’Œæäº¤ç‚¹æ–‡ä»¶ç»„æˆ 3.5. æ®µï¼ˆSegmentï¼‰ Lunceneé‡Œé¢çš„ä¸€ä¸ªæ•°æ®é›†æ¦‚å¿µï¼Œå› ä¸ºESåº•å±‚æ˜¯åŸºäºLucene æœ€æ ¸å¿ƒçš„æ¦‚å¿µå°±æ˜¯Segmentï¼Œæ¯ä¸ªæ®µæœ¬èº«å°±æ˜¯ä¸€ä¸ªå€’æ’ç´¢å¼• 3.6. æäº¤ç‚¹ï¼ˆcommit pointï¼‰ æœ‰ä¸€ä¸ªåˆ—è¡¨å­˜æ”¾ç€æ‰€æœ‰å·²çŸ¥çš„æ‰€æœ‰æ®µ 3.7. æ˜ å°„ æ˜ å°„æ˜¯å®šä¹‰ESå¯¹ç´¢å¼•ä¸­å­—æ®µçš„å­˜å‚¨ç±»å‹ï¼Œåˆ†è¯æ–¹å¼å’Œæ˜¯å¦å­˜å‚¨ç­‰ä¿¡æ¯ å°±åƒæ•°æ®åº“ä¸­çš„Schemaï¼Œæè¿°äº†æ–‡æ¡£å¯èƒ½å…·æœ‰çš„å­—æ®µæˆ–å±æ€§ï¼Œæ¯ä¸ªå­—æ®µçš„æ•°æ®ç±»å‹ Eså¯¹å­—æ®µç±»å‹å¯ä»¥ä¸æŒ‡å®šï¼Œç„¶ååŠ¨æ€å¯¹å­—æ®µç±»å‹çŒœæµ‹ ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºç´¢å¼•æ—¶å…·ä½“æŒ‡å®šå­—æ®µçš„ç±»å‹ï¼ˆå…³ç³»å‹æ•°æ®åº“æ‰éœ€è¦æ‰‹åŠ¨æŒ‡å®šï¼‰ 3.8. Shard åˆ†ç‰‡ å•å°æœºå™¨æ— æ³•å­˜å‚¨å¤§é‡æ•°æ®ï¼Œeså¯ä»¥å°†ä¸€ä¸ªç´¢å¼•ä¸­çš„æ•°æ®åˆ‡åˆ†ä¸ºå¤šä¸ªshardï¼Œåˆ†å¸ƒåœ¨å¤šå°æœåŠ¡å™¨ä¸Šå­˜å‚¨ æœ‰äº†shardå°±å¯ä»¥æ¨ªå‘æ‰©å±•ï¼Œå­˜å‚¨æ›´å¤šæ•°æ®ï¼Œè®©æœç´¢å’Œåˆ†æç­‰æ“ä½œåˆ†å¸ƒåˆ°å¤šå°æœåŠ¡å™¨ä¸Šå»æ‰§è¡Œï¼Œæå‡ååé‡å’Œæ€§èƒ½ æ¯ä¸ªshardéƒ½æ˜¯ä¸€ä¸ªlucene index 3.9. Replica å‰¯æœ¬ ä»»ä½•ä¸€ä¸ªæœåŠ¡å™¨éšæ—¶å¯èƒ½æ•…éšœæˆ–å®•æœºï¼Œæ­¤æ—¶shardå¯èƒ½å°±ä¼šä¸¢å¤±ï¼Œå› æ­¤å¯ä»¥ä¸ºæ¯ä¸ªshardåˆ›å»ºå¤šä¸ªreplicaå‰¯æœ¬ replicaå¯ä»¥åœ¨shardæ•…éšœæ—¶æä¾›å¤‡ç”¨æœåŠ¡ï¼Œä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œå¤šä¸ªreplicaè¿˜å¯ä»¥æå‡æœç´¢æ“ä½œçš„ååé‡å’Œæ€§èƒ½ primary shardï¼ˆå»ºç«‹ç´¢å¼•æ—¶ä¸€æ¬¡è®¾ç½®ï¼Œä¸èƒ½ä¿®æ”¹ï¼Œé»˜è®¤5ä¸ªï¼‰ï¼Œreplica shardï¼ˆéšæ—¶ä¿®æ”¹æ•°é‡ï¼Œé»˜è®¤1ä¸ªï¼‰ é»˜è®¤æ¯ä¸ªç´¢å¼•10ä¸ªshardï¼Œ5ä¸ªprimary shardï¼Œ5ä¸ªreplica shardï¼Œæœ€å°çš„é«˜å¯ç”¨é…ç½®ï¼Œæ˜¯2å°æœåŠ¡å™¨ 3.10. Clusteré›†ç¾¤ åŒ…å«å¤šä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å±äºå“ªä¸ªé›†ç¾¤æ˜¯é€šè¿‡ä¸€ä¸ªé…ç½®ï¼ˆé›†ç¾¤åç§°ï¼Œé»˜è®¤æ˜¯elasticsearchï¼‰æ¥å†³å®šçš„ å¯¹äºä¸­å°å‹åº”ç”¨æ¥è¯´ï¼Œåˆšå¼€å§‹ä¸€ä¸ªé›†ç¾¤å°±ä¸€ä¸ªèŠ‚ç‚¹å¾ˆæ­£å¸¸ 3.11. NodeèŠ‚ç‚¹ é›†ç¾¤çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¹Ÿæœ‰ä¸€ä¸ªåç§°ï¼ˆé»˜è®¤æ˜¯éšæœºåˆ†é…çš„ï¼‰ï¼ŒèŠ‚ç‚¹åç§°å¾ˆé‡è¦ï¼ˆåœ¨æ‰§è¡Œè¿ç»´ç®¡ç†æ“ä½œçš„æ—¶å€™ï¼‰ é»˜è®¤èŠ‚ç‚¹ä¼šå»åŠ å…¥ä¸€ä¸ªåç§°ä¸ºâ€œelasticsearchâ€çš„é›†ç¾¤ï¼Œå¦‚æœç›´æ¥å¯åŠ¨ä¸€å †èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šè‡ªåŠ¨ç»„æˆä¸€ä¸ªelasticsearché›†ç¾¤ å½“ç„¶ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥ç»„æˆä¸€ä¸ªelasticsearché›†ç¾¤ 4. ESä½¿ç”¨ 4.1. åˆ†ç‰‡çš„è®¾å®š åˆ†ç‰‡æ•°è¿‡å°ï¼Œæ•°æ®å†™å…¥å½¢æˆç“¶é¢ˆï¼Œæ— æ³•æ°´å¹³æ‹“å±• åˆ†ç‰‡æ•°è¿‡å¤šï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½æ˜¯ä¸€ä¸ªluceneçš„ç´¢å¼•ï¼Œåˆ†ç‰‡è¿‡å¤šå°†ä¼šå ç”¨è¿‡å¤šèµ„æº å¦‚ä½•è®¡ç®—åˆ†ç‰‡æ•° åˆ†ç‰‡æ•°é‡æœ€å¥½è®¾ç½®ä¸ºèŠ‚ç‚¹æ•°çš„æ•´æ•°å€ï¼Œä¿è¯æ¯ä¸€ä¸ªä¸»æœºçš„è´Ÿè½½æ˜¯å·®ä¸å¤šä¸€æ ·çš„ å¦åˆ™å¯èƒ½é‡åˆ°å…¶ä»–ä¸»æœºè´Ÿè½½æ­£å¸¸ï¼Œå°±æŸä¸ªä¸»æœºè´Ÿè½½ç‰¹åˆ«é«˜çš„æƒ…å†µ ä¸€èˆ¬æˆ‘ä»¬æ ¹æ®æ¯å¤©çš„æ•°æ®é‡æ¥è®¡ç®—åˆ†ç‰‡ï¼Œä¿æŒæ¯ä¸ªåˆ†ç‰‡çš„å¤§å°åœ¨ 50G ä»¥ä¸‹æ¯”è¾ƒåˆç† å¦‚æœè¿˜ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦åœ¨ç´¢å¼•å±‚é¢é€šè¿‡æ‹†åˆ†æ›´å¤šçš„ç´¢å¼•æˆ–è€…é€šè¿‡åˆ«å + æŒ‰å°æ—¶ åˆ›å»ºç´¢å¼• 4.2. ESæ•°æ®è¿‘å®æ—¶é—®é¢˜ ESæ•°æ®å†™å…¥ä¹‹åï¼Œè¦ç»è¿‡ä¸€ä¸ªrefreshæ“ä½œä¹‹åï¼Œæ‰èƒ½å¤Ÿåˆ›å»ºç´¢å¼•ï¼Œè¿›è¡ŒæŸ¥è¯¢ ä½†æ˜¯getæŸ¥è¯¢å¾ˆç‰¹æ®Šï¼Œæ•°æ®å®æ—¶å¯æŸ¥ getæŸ¥è¯¢çš„å®æ—¶æ€§ï¼Œé€šè¿‡æ¯æ¬¡getæŸ¥è¯¢çš„æ—¶å€™ å¦‚æœå‘ç°è¯¥idè¿˜åœ¨å†…å­˜ä¸­æ²¡æœ‰åˆ›å»ºç´¢å¼•ï¼Œé‚£ä¹ˆé¦–å…ˆä¼šè§¦å‘refreshæ“ä½œï¼Œæ¥è®©idå¯æŸ¥ ES5.0ä¹‹å‰translogå¯ä»¥æä¾›å®æ—¶çš„CRUD getæŸ¥è¯¢ä¼šé¦–å…ˆæ£€æŸ¥translogä¸­æœ‰æ²¡æœ‰æœ€æ–°çš„ä¿®æ”¹ï¼Œç„¶åå†å°è¯•å»segmentä¸­å¯¹idè¿›è¡ŒæŸ¥æ‰¾ 5.0ä¹‹åï¼Œä¸ºäº†å‡å°‘translogè®¾è®¡çš„å¤æ‚æ€§ä»¥ä¾¿äºå†å…¶ä»–æ›´é‡è¦çš„æ–¹é¢å¯¹translogè¿›è¡Œä¼˜åŒ– æ‰€ä»¥å–æ¶ˆäº†translogçš„å®æ—¶æŸ¥è¯¢åŠŸèƒ½ console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"docker-an-zhuang-es.html":{"url":"docker-an-zhuang-es.html","title":"Dockerå®‰è£…es","keywords":"","body":" Dockerå®‰è£…es1. åŸºäºDockerå®‰è£…Elasticsearch1.1. åˆ›å»ºç½‘ç»œ1.2. æ‹‰å–é•œåƒ1.3. åˆ›å»ºæŒ‚è½½ç‚¹ç›®å½•1.4. éƒ¨ç½²å•ç‚¹esï¼Œåˆ›å»ºeså®¹å™¨1.5. è¿›å…¥eså®¹å™¨1.6. é‡å¯eså®¹å™¨2. åŸºäºDockerå®‰è£…Kibana2.1. åˆ›å»ºæŒ‚è½½ç‚¹ç›®å½•2.2. éƒ¨ç½²kibanaï¼Œåˆ›å»ºkibanaå®¹å™¨2.3. æµ‹è¯•Kibanaæ˜¯å¦å®‰è£…æˆåŠŸ Dockerå®‰è£…es 1. åŸºäºDockerå®‰è£…Elasticsearch 1.1. åˆ›å»ºç½‘ç»œ å› ä¸ºéœ€è¦éƒ¨ç½²kibanaå®¹å™¨ï¼Œå› æ­¤éœ€è¦è®©eså’Œkibanaå®¹å™¨äº’è”ã€‚ docker network create es-net 1.2. æ‹‰å–é•œåƒ ä»¥å®‰è£…Elasticsearch 8.6.0 ç‰ˆæœ¬ä¸ºä¾‹ docker pull elasticsearch:8.6.0 1.3. åˆ›å»ºæŒ‚è½½ç‚¹ç›®å½• mkdir -p ./es/data ./es/config ./es/plugins å˜ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ chmod 777 ./es/data chmod 777 ./es/config chmod 777 ./es/plugins 1.4. éƒ¨ç½²å•ç‚¹esï¼Œåˆ›å»ºeså®¹å™¨ docker run -d \\ --restart=always \\ --name es \\ --network es-net \\ -p 9200:9200 \\ -p 9300:9300 \\ --privileged \\ -v /Users/wyx/MyFile/Docker/es/data:/usr/share/elasticsearch/data \\ -v /Users/wyx/MyFile/Docker/es/plugins:/usr/share/elasticsearch/plugins \\ -e \"discovery.type=single-node\" \\ -e \"ES_JAVA_OPTS=-Xms512m -Xmx512m\" \\ elasticsearch:8.6.0 1.5. è¿›å…¥eså®¹å™¨ docker exec -it es /bin/bash ç¼–å†™elasticsearch.yml è·³è½¬åˆ°configç›®å½•ä¸‹ cd config echo 'xpack.security.enabled: false' >> elasticsearch.yml echo 'xpack.security.http.ssl.enabled: false' >> elasticsearch.yml é‡ç½®å¯†ç  è®°ä½New value: **0000000 docker exec -it elasticsearch1 /bin/bash å¯ç”¨å¯†ç  æƒ³å¯ç”¨å¯†ç æ‰“å¼€å³å¯ xpack.security.enabled: true è®¾ç½® JVM å†…å­˜å‚æ•°(å¯é€‰è®¾ç½®) docker exec -it elasticsearch1 /bin/bash vi /usr/share/elasticsearch/config/jvm.optionsä¿®æ”¹å¦‚ä¸‹é…ç½®ï¼š ################################################################ ## IMPORTANT: JVM heap size ################################################################ ## ## The heap size is automatically configured by Elasticsearch ## based on the available memory in your system and the roles ## each node is configured to fulfill. If specifying heap is ## required, it should be done through a file in jvm.options.d, ## which should be named with .options suffix, and the min and ## max should be set to the same value. For example, to set the ## heap to 4 GB, create a new file in the jvm.options.d ## directory containing these lines: ## ## -Xms4g ## -Xmx4g ## ## See https://www.elastic.co/guide/en/elasticsearch/reference/8.9/heap-size.html ## for more information ## ################################################################ -Xms1g -Xmx1g åŸºäºDockerå®‰è£…IKåˆ†è¯å™¨ æ³¨æ„ï¼šå®‰è£…IKåˆ†è¯å™¨çš„ç‰ˆæœ¬ï¼Œå¿…é¡»å’ŒElasticsearchçš„ç‰ˆæœ¬ä¸€è‡´ï¼Œ ä¸Šæ–‡å®‰è£…çš„æ˜¯Elasticsearch 8.6.0çš„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å®‰è£…çš„IKåˆ†è¯å™¨ç‰ˆæœ¬æ˜¯8.6.0 ç›´æ¥æ‰§è¡Œå³å¯ ./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v8.6.0/elasticsearch-analysis-ik-8.6.0.zip å¦‚æœéœ€è¦å®‰è£…å…¶ä»–ç‰ˆæœ¬çš„IKåˆ†è¯å™¨ï¼Œéœ€è¦æŠŠç‰ˆæœ¬å·ä¿®æ”¹å³å¯ ./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.4.2/elasticsearch-analysis-ik-7.4.2.zip ./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v8.6.0/elasticsearch-analysis-ik-8.6.0.zip 1.6. é‡å¯eså®¹å™¨ docker restart es æµ‹è¯• http://localhost:9200 2. åŸºäºDockerå®‰è£…Kibana docker pull kibana:8.6.0 2.1. åˆ›å»ºæŒ‚è½½ç‚¹ç›®å½• mkdir -p ./kibana/config ./kibana/data chmod 777 /usr/local/kibana/data chmod 777 /usr/local/kibana/config 2.2. éƒ¨ç½²kibanaï¼Œåˆ›å»ºkibanaå®¹å™¨ docker run -d \\ --restart=always \\ --name kibana \\ --network es-net \\ -p 5601:5601 \\ -e ELASTICSEARCH_HOSTS=http://es:9200 \\ kibana:8.6.0 2.3. æµ‹è¯•Kibanaæ˜¯å¦å®‰è£…æˆåŠŸ è®¿é—®è™šæ‹Ÿæœºåœ°å€+ç«¯å£å·ï¼Œå‰é¢é…ç½®Kibana çš„ç«¯å£å·ä¸ºï¼š5601 http://localhost:5601\\ console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"es-ji-ben-yu-fa.html":{"url":"es-ji-ben-yu-fa.html","title":"ESåŸºæœ¬è¯­æ³•","keywords":"","body":" ESåŸºæœ¬è¯­æ³•1.1. æ¦‚å¿µ1.2. åŸºæœ¬è¯­æ³• ESåŸºæœ¬è¯­æ³• 1.1. æ¦‚å¿µ ç´¢å¼•ï¼ˆIndexï¼‰æ–‡æ¡£ PUT /ç´¢å¼•åç§°/_doc/æ–‡æ¡£ID { \"field1\": \"value1\", \"field2\": \"value2\", ... } è·å–ï¼ˆGetï¼‰æ–‡æ¡£ GET /ç´¢å¼•åç§°/_doc/æ–‡æ¡£ID æ›´æ–°ï¼ˆUpdateï¼‰æ–‡æ¡£ POST /ç´¢å¼•åç§°/_update/æ–‡æ¡£ID { \"doc\": { \"field1\": \"new_value1\", \"field2\": \"new_value2\", ... } } åˆ é™¤ï¼ˆDeleteï¼‰æ–‡æ¡£ DELETE /ç´¢å¼•åç§°/_doc/æ–‡æ¡£ID æœç´¢ï¼ˆSearchï¼‰æ–‡æ¡£ GET /ç´¢å¼•åç§°/_search { \"query\": { \"match\": { \"field\": \"value\" } } } è¿™äº›è¯­å¥ä¸­çš„å…³é”®ç‚¹è§£é‡Šå¦‚ä¸‹ï¼š /ç´¢å¼•åç§°ï¼šæŒ‡å®šè¦æ“ä½œçš„ç´¢å¼•åç§°ã€‚ /_docï¼šæŒ‡å®šæ–‡æ¡£ç±»å‹ï¼Œä» Elasticsearch 7.x ç‰ˆæœ¬å¼€å§‹ï¼Œé»˜è®¤ç±»å‹ä¸º _docã€‚ /æ–‡æ¡£IDï¼šæŒ‡å®šè¦æ“ä½œçš„æ–‡æ¡£çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚ åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä½ éœ€è¦å°†è¿™äº›è¯­å¥ä¸­çš„å ä½ç¬¦æ›¿æ¢ä¸ºä½ å®é™…çš„ç´¢å¼•åç§°ã€æ–‡æ¡£IDå’Œå­—æ®µå€¼ã€‚ è¯·æ³¨æ„ï¼ŒElasticsearch è¿˜æä¾›äº†æ›´å¤šé«˜çº§çš„æŸ¥è¯¢å’Œæ“ä½œåŠŸèƒ½ï¼Œä¾‹å¦‚èšåˆã€è¿‡æ»¤å™¨ç­‰ã€‚ä»¥ä¸Šåªæ˜¯ä¸€äº›åŸºæœ¬çš„ç¤ºä¾‹ï¼Œä½ å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œæ›´å¤æ‚çš„æŸ¥è¯¢å’Œæ“ä½œã€‚ 1.2. åŸºæœ¬è¯­æ³• // è·å–æ‰€æœ‰ GET /_search { \"took\": 410, \"timed_out\": false, \"_shards\": { \"total\": 1, \"successful\": 1, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": { \"value\": 0, \"relation\": \"eq\" }, \"max_score\": null, \"hits\": [] } } 1 tookï¼šè€—è´¹äº†å‡ æ¯«ç§’ 2 timed_outï¼šæ˜¯å¦è¶…æ—¶ï¼Œfalseæ˜¯æ²¡æœ‰ï¼Œé»˜è®¤æ— timeout 3 _shardsï¼šshards failçš„æ¡ä»¶ï¼ˆprimaryå’Œreplicaå…¨éƒ¨æŒ‚æ‰ï¼‰ï¼Œä¸å½±å“å…¶ä»–shardã€‚é»˜è®¤æƒ…å†µä¸‹æ¥è¯´ï¼Œä¸€ä¸ªæœç´¢è¯·æ±‚ï¼Œä¼šæ‰“åˆ°ä¸€ä¸ªindexçš„æ‰€æœ‰primary shardä¸Šå»ï¼Œå½“ç„¶äº†ï¼Œæ¯ä¸ªprimary shardéƒ½å¯èƒ½ä¼šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªreplic shardï¼Œæ‰€ä»¥è¯·æ±‚ä¹Ÿå¯ä»¥åˆ°primary shardçš„å…¶ä¸­ä¸€ä¸ªreplica shardä¸Šå»ã€‚ 4 hits.totalï¼šæœ¬æ¬¡æœç´¢ï¼Œè¿”å›äº†å‡ æ¡ç»“æœ 5 hits.max_scoreï¼šscoreçš„å«ä¹‰ï¼Œå°±æ˜¯documentå¯¹äºä¸€ä¸ªsearchçš„ç›¸å…³åº¦çš„åŒ¹é…åˆ†æ•°ï¼Œè¶Šç›¸å…³ï¼Œå°±è¶ŠåŒ¹é…ï¼Œåˆ†æ•°ä¹Ÿé«˜ 6 hits.hitsï¼šåŒ…å«äº†åŒ¹é…æœç´¢çš„documentçš„è¯¦ç»†æ•°æ®ï¼Œé»˜è®¤æŸ¥è¯¢å‰10æ¡æ•°æ®ï¼ŒæŒ‰_scoreé™åºæ’åº åˆ›å»ºç´¢å¼• // åˆ›å»ºç´¢å¼• PUT /test_es { \"mappings\": { \"properties\": { \"name\": { \"type\": \"text\", \"fields\": { \"keyword\": { \"type\": \"keyword\" } } }, \"age\": { \"type\": \"integer\" }, \"email\": { \"type\": \"keyword\" }, \"date_of_birth\": { \"type\": \"date\" }, \"address\": { \"type\": \"nested\", \"properties\": { \"street\": { \"type\": \"text\" }, \"city\": { \"type\": \"text\" }, \"country\": { \"type\": \"keyword\" } } } } } } { \"acknowledged\": true, \"shards_acknowledged\": true, \"index\": \"test_es\" } åˆ›å»ºå€¼ // ä¸ºç´¢å¼•æ·»åŠ å€¼ POST /test_es/_doc/1 { \"name\": \"John\", \"age\": 30, \"email\": \"john@example.com\", \"date_of_birth\": \"1990-01-01\", \"address\": { \"street\": \"123 Main St\", \"city\": \"New York\", \"country\": \"USA\" } } POST /test_es/_doc/2 { \"name\": \"Jane\", \"age\": 25, \"email\": \"jane@example.com\", \"date_of_birth\": \"1995-05-10\", \"address\": { \"street\": \"456 Elm St\", \"city\": \"London\", \"country\": \"UK\" } } { \"_index\": \"test_es\", \"_id\": \"1\", \"_version\": 1, \"result\": \"created\", \"_shards\": { \"total\": 2, \"successful\": 1, \"failed\": 0 }, \"_seq_no\": 0, \"_primary_term\": 1 } æ¡ä»¶æŸ¥è¯¢ // æŸ¥è¯¢ GET /test_es/_search { \"query\": { \"match\": { \"name\": \"John\" } } } { \"took\": 475, \"timed_out\": false, \"_shards\": { \"total\": 1, \"successful\": 1, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": { \"value\": 1, \"relation\": \"eq\" }, \"max_score\": 0.6931471, \"hits\": [ { \"_index\": \"test_es\", \"_id\": \"1\", \"_score\": 0.6931471, \"_source\": { \"name\": \"John\", \"age\": 30, \"email\": \"john@example.com\", \"date_of_birth\": \"1990-01-01\", \"address\": { \"street\": \"123 Main St\", \"city\": \"New York\", \"country\": \"USA\" } } } ] } } ä¿®æ”¹ // ä¿®æ”¹ POST /test_es/_update/1 { \"doc\": { \"age\": 35 } } { \"_index\": \"test_es\", \"_id\": \"1\", \"_version\": 2, \"result\": \"updated\", \"_shards\": { \"total\": 2, \"successful\": 1, \"failed\": 0 }, \"_seq_no\": 2, \"_primary_term\": 1 } åˆ é™¤ // åˆ é™¤ DELETE /test_es/_doc/1 { \"_index\": \"test_es\", \"_id\": \"1\", \"_version\": 3, \"result\": \"deleted\", \"_shards\": { \"total\": 2, \"successful\": 1, \"failed\": 0 }, \"_seq_no\": 3, \"_primary_term\": 1 } console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"es-yu-fa-jin-jie.html":{"url":"es-yu-fa-jin-jie.html","title":"ESè¯­æ³•è¿›é˜¶ï¼ˆğŸ“Œï¼‰","keywords":"","body":" ESè¯­æ³•è¿›é˜¶ï¼ˆ&#x1F4CC;ï¼‰1. urlå‚æ•°æœç´¢1.1. æŸ¥è¯¢æ‰€æœ‰1.2. å¤šç´¢å¼•ï¼Œå¤štypeæœç´¢1.3. æŒ‰æ¡ä»¶æŸ¥è¯¢1.4. æŸ¥è¯¢DSL1.5. å¤åˆæŸ¥è¯¢2. æŸ¥è¯¢ç¤ºä¾‹2.1. è·å–æ‰€æœ‰2.2. åˆ†é¡µæŸ¥è¯¢2.3. æŒ‡å®šæŸ¥è¯¢å‡ºæ¥çš„æ•°æ®è¿”å›çš„å­—æ®µ2.4. adå­—æ®µä¸­åŒ…å«å•è¯white2.5. adå­—æ®µä¸­åŒ…å«å•è¯whiteï¼Œå¹¶æŒ‰ç…§ä»·æ ¼å‡åºæ’åˆ—2.6. ä»·æ ¼å­—æ®µå¤§äº50002.7. adå­—æ®µä¸­åŒ…å«å•è¯whiteï¼Œä»·æ ¼å­—æ®µå¤§äº50002.8. æŸ¥è¯¢nameå­—æ®µåŒ…å«å•è¯phoneçš„æ–‡æ¡£çš„æ•°é‡3. å…³é”®è¯è¯¦è§£3.1. match_allæŸ¥è¯¢3.2. matchæŸ¥è¯¢3.3. multi_matchæŸ¥è¯¢3.4. rangeæŸ¥è¯¢3.5. termæŸ¥è¯¢3.6. termsæŸ¥è¯¢3.7. exists æŸ¥è¯¢å’Œ missing æŸ¥è¯¢3.8. match_phraseæŸ¥è¯¢3.9. scrollæŸ¥è¯¢3.10. multi getæŸ¥è¯¢3.11. bulkæ‰¹é‡æ“ä½œ3.12. fuzzyæŸ¥è¯¢3.13. wildcardæŸ¥è¯¢ ESè¯­æ³•è¿›é˜¶ï¼ˆ&#x1F4CC;ï¼‰ 1. urlå‚æ•°æœç´¢ è¿™ç§æ–¹å¼å°±æ˜¯ç±»ä¼¼äºgetè¯·æ±‚ï¼Œå°†è¯·æ±‚å‚æ•°æ‹¼æ¥åˆ°é“¾æ¥ä¸Šï¼Œä¾‹GET /school/student/_search?å‚æ•°ï¼Œå¤šä¸ªå‚æ•°ç”¨&åˆ†å¼€ 1.1. æŸ¥è¯¢æ‰€æœ‰ å‘½ä»¤ï¼šGET /school/student/_search è¿”å›ï¼š { \"took\": 7, //æŸ¥è¯¢è€—æ—¶ï¼Œæ¯«ç§’ \"timed_out\": false, //æ˜¯å¦è¶…æ—¶ï¼Œtimeout ä¸æ˜¯åœæ­¢æ‰§è¡ŒæŸ¥è¯¢ï¼Œå®ƒä»…ä»…æ˜¯å‘ŠçŸ¥æ­£åœ¨åè°ƒçš„èŠ‚ç‚¹è¿”å›åˆ°ç›®å‰ä¸ºæ­¢æ”¶é›†çš„ç»“æœå¹¶ä¸”å…³é—­è¿æ¥ \"_shards\": { \"total\": 5, //è¯·æ±‚çš„åˆ†ç‰‡æ•°é‡ï¼Œç´¢å¼•æ‹†æˆäº†5ä¸ªåˆ†ç‰‡ï¼Œæ‰€ä»¥å¯¹äºæœç´¢è¯·æ±‚ï¼Œä¼šæ‰“åˆ°æ‰€æœ‰çš„primary shard \"successful\": 5, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": 2, //ç¬¦åˆæ¡ä»¶çš„æ€»æ¡æ•°ï¼Œè¿™é‡ŒæŸ¥çš„æ˜¯æ‰€æœ‰ \"max_score\": 1, //åŒ¹é…åˆ†æ•° \"hits\": [ //æ•°æ® { \"_index\": \"school\", \"_type\": \"student\", \"_id\": \"2\", \"_score\": 1, \"_source\": { \"name\": \"houyi\", \"age\": 23, \"class\": 2, \"gender\": \"ç”·\" } }, { \"_index\": \"school\", \"_type\": \"student\", \"_id\": \"1\", \"_score\": 1, \"_source\": { \"name\": \"å•å¸ƒ\", \"age\": 21, \"class\": 2, \"gender\": \"ç”·\" } } ] } } 1.2. å¤šç´¢å¼•ï¼Œå¤štypeæœç´¢ åœ¨URLä¸­æŒ‡å®šç‰¹æ®Šçš„ç´¢å¼•å’Œç±»å‹è¿›è¡Œå¤šç´¢å¼•ï¼Œå¤štypeæœç´¢ /_searchï¼šåœ¨æ‰€æœ‰çš„ç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„ç±»å‹ /school/_searchï¼šåœ¨ school ç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„ç±»å‹ /school,ad/_searchï¼šåœ¨ school å’Œadç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„ç±»å‹ /s*,a*/_searchï¼šåœ¨æ‰€æœ‰ä»¥gå’Œaå¼€å¤´çš„ç´¢å¼•ä¸­æ‰€æœ‰æ‰€æœ‰çš„ç±»å‹ /school/student/_searchï¼šåœ¨schoolç´¢å¼•ä¸­æœç´¢studentç±»å‹ /school,ad/student,phone/_searchï¼šåœ¨schoolå’Œadç´¢å¼•ä¸Šæœç´¢studentå’Œphoneç±»å‹ /_all/student,phone/_searchï¼šåœ¨æ‰€æœ‰çš„ç´¢å¼•ä¸­æœç´¢studentå’Œphoneç±»å‹ 1.3. æŒ‰æ¡ä»¶æŸ¥è¯¢ å‘½ä»¤ï¼šGET /school/student/_search?q=name:houyi æŸ¥è¯¢nameæ˜¯houyiçš„è®°å½• æ›´å¤šæŸ¥è¯¢å‚æ•°ï¼š 1.4. æŸ¥è¯¢DSL elasticsearchæä¾›äº†åŸºäºJSONçš„å®Œæ•´æŸ¥è¯¢DSLæ¥å®šä¹‰æŸ¥è¯¢ï¼ŒDSLæ‹¥æœ‰ä¸€å¥—æŸ¥è¯¢ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶å¯ä»¥ä»¥æ— é™ç»„åˆçš„æ–¹å¼è¿›è¡Œæ­é…ï¼Œæ„å»ºå„ç§å¤æ‚çš„æŸ¥è¯¢ å¶å­è¯­å¥ å¶å­è¯­å¥ï¼šå°±åƒmatchè¯­å¥ï¼Œè¢«ç”¨äºå°†æŸ¥è¯¢çš„å­—ç¬¦ä¸²ä¸ä¸€ä¸ªå­—æ®µæˆ–å¤šä¸ªå­—æ®µè¿›è¡Œå¯¹æ¯”ï¼ˆå•ä¸ªæ¡ä»¶ï¼‰ æ¯”å¦‚ï¼š GET /ad/phone/_search { \"query\": { \"match\": { \"name\": \"phone\" } } } 1.5. å¤åˆæŸ¥è¯¢ ç”¨æˆ·åˆå¹¶å…¶ä»–æŸ¥è¯¢è¯­å¥ï¼Œæ¯”å¦‚ä¸€ä¸ªboolè¯­å¥ï¼Œå…è®¸ä½ åœ¨éœ€è¦çš„æ—¶å€™ç»„åˆå…¶ä»–è¯­å¥ï¼ŒåŒ…æ‹¬mustï¼Œmust_notï¼Œshouldå’Œfilterè¯­å¥ï¼ˆå¤šæ¡ä»¶ç»„åˆæŸ¥è¯¢ï¼‰ æ¯”å¦‚ï¼š GET /ad/phone/_search { \"query\": { \"bool\": { \"must\": [ {\"match\": { \"name\": \"phone\" }} ] , \"must_not\": [ {\"match\": { \"color\": \"red\" }} ] , \"should\": [ {\"match\": { \"price\": 5000 }} ] , \"filter\": { \"term\": { \"label\": \"phone\" } } } } } mustï¼šè¡¨ç¤ºæ–‡æ¡£ä¸€å®šè¦åŒ…å«æŸ¥è¯¢çš„å†…å®¹ must_notï¼šè¡¨ç¤ºæ–‡æ¡£ä¸€å®šä¸è¦åŒ…å«æŸ¥è¯¢çš„å†…å®¹ shouldï¼šè¡¨ç¤ºå¦‚æœæ–‡æ¡£åŒ¹é…ä¸Šå¯ä»¥å¢åŠ æ–‡æ¡£ç›¸å…³æ€§å¾—åˆ† äº‹å®ä¸Šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ç§ç»“æ„åŒ–è¯­å¥ï¼š ç»“æ„åŒ–æŸ¥è¯¢query DSLå’Œç»“æ„åŒ–è¿‡æ»¤Filter DSL ç»“æ„åŒ–æŸ¥è¯¢query DSL ç”¨äºæ£€æŸ¥å†…å®¹ä¸æ¡ä»¶æ˜¯å¦åŒ¹é…ï¼Œå†…å®¹æŸ¥è¯¢ä¸­ä½¿ç”¨çš„boolå’Œmatchå­—å¥ï¼Œç”¨äºè®¡ç®—æ¯ä¸ªæ–‡æ¡£çš„åŒ¹é…å¾—åˆ†ï¼Œå…ƒå­—æ®µ_scoreè¡¨ç¤ºåŒ¹é…åº¦ï¼ŒæŸ¥è¯¢çš„ç»“æ„ä¸­ä»¥queryå‚æ•°å¼€å§‹æ¥æ‰§è¡Œå†…å®¹æŸ¥è¯¢ ç»“æ„åŒ–è¿‡æ»¤Filter DSL åªæ˜¯ç®€å•çš„å†³å®šæ–‡æ¡£æ˜¯å¦åŒ¹é…ï¼Œå†…å®¹è¿‡æ»¤ä¸­ä½¿ç”¨çš„termå’Œrangeå­—å¥ï¼Œä¼šè¿‡æ»¤ è°ƒä¸åŒ¹é…çš„æ–‡æ¡£ï¼Œå¹¶ä¸”ä¸å½±å“è®¡ç®—æ–‡æ¡£åŒ¹é…å¾—åˆ† ä½¿ç”¨è¿‡æ»¤æŸ¥è¯¢ä¼šè¢«esè‡ªåŠ¨ç¼“å­˜ç”¨æ¥æé«˜æ•ˆç‡ åŸåˆ™ä¸Šæ¥è¯´ï¼Œä½¿ç”¨æŸ¥è¯¢è¯­å¥åšå…¨æ–‡æœ¬æœç´¢æˆ–å…¶ä»–éœ€è¦è¿›è¡Œç›¸å…³æ€§è¯„åˆ†çš„æ—¶å€™ï¼Œå‰©ä¸‹çš„å…¨éƒ¨ç”¨è¿‡æ»¤è¯­å¥ æ–°å»ºä¸€ä¸ªç¨å¾®å¤æ‚çš„ç´¢å¼•ï¼Œæ·»åŠ ä¸‰æ¡æ–‡æ¡£ PUT /ad/phone/1 { \"name\":\"phone 8\", \"price\": 6000, \"color\":\"white\", \"ad\":\"this is a white phone\", \"label\":[\"white\",\"nice\"] } PUT /ad/phone/2 { \"name\":\"xiaomi 8\", \"price\": 4000, \"color\":\"red\", \"ad\":\"this is a red phone\", \"label\":[\"white\",\"xiaomi\"] } PUT /ad/phone/3 { \"name\":\"huawei p30\", \"price\": 5000, \"color\":\"white\", \"ad\":\"this is a white phone\", \"label\":[\"white\",\"huawei\"] } 2. æŸ¥è¯¢ç¤ºä¾‹ 2.1. è·å–æ‰€æœ‰ GET /ad/phone/_search { \"query\": { \"match_all\": {} } } match_allåŒ¹é…æ‰€æœ‰æ•°æ®ï¼Œè¿”å›çš„ç»“æœä¸­å…ƒå­—æ®µ_scoreå¾—åˆ†ä¸º1 2.2. åˆ†é¡µæŸ¥è¯¢ ä»ç¬¬äºŒæ¡å¼€å§‹ï¼ŒæŸ¥ä¸¤æ¡ï¼ˆä¸è¦ä½¿ç”¨fromï¼Œsizeè¿›è¡Œæ·±åº¦åˆ†é¡µï¼Œä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼‰ GET /ad/phone/_search { \"query\": { \"match_all\": {} }, \"from\": 1, \"size\": 2 } è¿™ç§åˆ†é¡µæ–¹å¼å¦‚æœè¿›è¡Œæ·±åº¦åˆ†é¡µï¼Œæ¯”å¦‚åˆ°100é¡µï¼Œæ¯é¡µåæ¡æ•°æ®ï¼Œå®ƒä¼šä»æ¯ä¸ªåˆ†ç‰‡éƒ½æŸ¥è¯¢å‡º100*10æ¡æ•°æ®ï¼Œå‡è®¾æœ‰äº”ä¸ªåˆ†ç‰‡ï¼Œå°±æ˜¯5000æ¡æ•°æ®ï¼Œç„¶ååœ¨å†…å­˜ä¸­è¿›è¡Œæ’åºï¼Œç„¶åè¿”å›æ‹è¿‡åºä¹‹åçš„é›†åˆä¸­çš„ç¬¬1000-1010æ¡æ•°æ® 2.3. æŒ‡å®šæŸ¥è¯¢å‡ºæ¥çš„æ•°æ®è¿”å›çš„å­—æ®µ GET /ad/phone/_search { \"query\": { \"match_all\": {} }, \"_source\": [\"name\",\"price\"] } è¿”å›çš„æ•°æ®ä¸­åªè¿”å›nameå’Œpriceå­—æ®µ 2.4. adå­—æ®µä¸­åŒ…å«å•è¯white GET /ad/phone/_search { \"query\": { \"match\": { \"ad\": \"white\" } } } è¿”å›çš„ç»“æœä¸­å…ƒå­—æ®µ_scoreæœ‰è¯„åˆ†ï¼Œè¯´æ˜ä½¿ç”¨queryä¼šè®¡ç®—è¯„åˆ† 2.5. adå­—æ®µä¸­åŒ…å«å•è¯whiteï¼Œå¹¶æŒ‰ç…§ä»·æ ¼å‡åºæ’åˆ— GET /ad/phone/_search { \"query\": { \"match\": { \"ad\": \"white\" } }, \"sort\": [ { \"price\": { \"order\": \"asc\" } } ] } 2.6. ä»·æ ¼å­—æ®µå¤§äº5000 GET /ad/phone/_search { \"query\": { \"bool\": { \"filter\": { \"range\": { \"price\": { \"gt\": 5000 } } } } } } è¿”å›çš„ç»“æœä¸­å…ƒå­—æ®µ_scoreå­—æ®µç­‰äº0ï¼Œæ²¡è¯„åˆ†ï¼Œè¯´æ˜ä½¿ç”¨filterä¸ä¼šè®¡ç®—è¯„åˆ† 2.7. adå­—æ®µä¸­åŒ…å«å•è¯whiteï¼Œä»·æ ¼å­—æ®µå¤§äº5000 GET /ad/phone/_search { \"query\": { \"bool\": { \"must\": [ { \"match\": { \"ad\": \"white\" } } ], \"filter\": { \"range\": { \"price\": { \"gt\": 5000 } } } } } } 2.8. æŸ¥è¯¢nameå­—æ®µåŒ…å«å•è¯phoneçš„æ–‡æ¡£çš„æ•°é‡ GET /ad/phone/_count { \"query\": { \"match\": { \"name\": \"phone\" } } } 3. å…³é”®è¯è¯¦è§£ 3.1. match_allæŸ¥è¯¢ æŸ¥è¯¢ç®€å•çš„åŒ¹é…æ‰€æœ‰æ–‡æ¡£ GET /ad/phone/_search { \"query\": { \"match_all\": {} } } 3.2. matchæŸ¥è¯¢ æ”¯æŒå…¨æ–‡æœç´¢å’Œç²¾ç¡®æŸ¥è¯¢ï¼Œå–å†³äºå­—æ®µæ˜¯å¦æ”¯æŒå…¨æ–‡æ£€ç´¢ å…¨æ–‡æ£€ç´¢ï¼š GET /ad/phone/_search { \"query\": { \"match\": { \"ad\": \"a red\" } } } å…¨æ–‡æ£€ç´¢ä¼šå°†æŸ¥è¯¢çš„å­—ç¬¦ä¸²å…ˆè¿›è¡Œåˆ†è¯ï¼Œa redä¼šåˆ†æˆä¸ºaå’Œredï¼Œç„¶ååœ¨å€’æ’ç´¢å¼•ä¸­è¿›è¡ŒåŒ¹é…ï¼Œæ‰€ä»¥è¿™æ¡è¯­å¥ä¼šå°†ä¸‰æ¡æ–‡æ¡£éƒ½æŸ¥å‡ºæ¥ ç²¾ç¡®æŸ¥è¯¢ï¼š GET /ad/phone/_search { \"query\": { \"match\": { \"price\": \"6000\" } } } å¯¹äºç²¾ç¡®å€¼çš„æŸ¥è¯¢ï¼Œå¯ä»¥ä½¿ç”¨ filter è¯­å¥æ¥å–ä»£ queryï¼Œå› ä¸º filter å°†ä¼šè¢«ç¼“å­˜ operatoræ“ä½œï¼š match æŸ¥è¯¢è¿˜å¯ä»¥æ¥å— operator æ“ä½œç¬¦ä½œä¸ºè¾“å…¥å‚æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹è¯¥æ“ä½œç¬¦æ˜¯ or ã€‚æˆ‘ä»¬å¯ä»¥å°†å®ƒä¿®æ”¹æˆ and è®©æ‰€æœ‰æŒ‡å®šè¯é¡¹éƒ½å¿…é¡»åŒ¹é… GET /ad/phone/_search { \"query\": { \"match\": { \"ad\": { \"query\": \"a red\", \"operator\": \"and\" } } } } ç²¾ç¡®åº¦åŒ¹é…ï¼š match æŸ¥è¯¢æ”¯æŒ minimum_should_match æœ€å°åŒ¹é…å‚æ•°ï¼Œ å¯ä»¥æŒ‡å®šå¿…é¡»åŒ¹é…çš„è¯é¡¹æ•°ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªæ–‡æ¡£æ˜¯å¦ç›¸å…³ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶è®¾ç½®ä¸ºæŸä¸ªå…·ä½“æ•°å­—ï¼ˆæŒ‡éœ€è¦åŒ¹é…å€’æ’ç´¢å¼•çš„è¯çš„æ•°é‡ï¼‰ï¼Œæ›´å¸¸ç”¨çš„åšæ³•æ˜¯å°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªç™¾åˆ†æ•°ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•æ§åˆ¶ç”¨æˆ·æœç´¢æ—¶è¾“å…¥çš„å•è¯æ•°é‡ GET /ad/phone/_search { \"query\": { \"match\": { \"ad\": { \"query\": \"a red\", \"minimum_should_match\": \"2\" } } } } åªä¼šè¿”å›åŒ¹é…ä¸Šaå’Œredä¸¤ä¸ªè¯çš„æ–‡æ¡£è¿”å›ï¼Œå¦‚æœminimum_should_matchæ˜¯1ï¼Œåˆ™åªè¦åŒ¹é…ä¸Šå…¶ä¸­ä¸€ä¸ªè¯ï¼Œæ–‡æ¡£å°±ä¼šè¿”å› 3.3. multi_matchæŸ¥è¯¢ å¤šå­—æ®µæŸ¥è¯¢ï¼Œæ¯”å¦‚æŸ¥è¯¢colorå’Œadå­—æ®µåŒ…å«å•è¯redçš„æ–‡æ¡£ GET /ad/phone/_search { \"query\": { \"multi_match\": { \"query\": \"red\", \"fields\": [\"color\",\"ad\"] } } } 3.4. rangeæŸ¥è¯¢ èŒƒå›´æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä»·æ ¼å¤§äº4000å°äº6000çš„æ–‡æ¡£ GET /ad/phone/_search { \"query\": { \"range\": { \"price\": { \"gt\": 4000, \"lt\": 6000 } } } } èŒƒå›´æŸ¥è¯¢æ“ä½œç¬¦ï¼šgt ï¼ˆå¤§äºï¼‰ï¼Œgteï¼ˆå¤§äºç­‰äºï¼‰ï¼Œltï¼ˆå°äºï¼‰ï¼Œlteï¼ˆå°äºç­‰äº)ï¼› 3.5. termæŸ¥è¯¢ ç²¾ç¡®å€¼æŸ¥è¯¢ æŸ¥è¯¢priceå­—æ®µç­‰äº6000çš„æ–‡æ¡£ GET /ad/phone/_search { \"query\": { \"term\": { \"price\": { \"value\": \"6000\" } } } } æŸ¥è¯¢nameå­—æ®µç­‰äºphone 8çš„æ–‡æ¡£ GET /ad/phone/_search { \"query\": { \"term\": { \"name\": { \"value\": \"phone 8\" } } } } è¿”å›å€¼å¦‚ä¸‹ï¼Œæ²¡æœ‰æŸ¥è¯¢åˆ°åç§°ä¸ºphone 8çš„æ–‡æ¡£ { \"took\": 5, \"timed_out\": false, \"_shards\": { \"total\": 5, \"successful\": 5, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": 0, \"max_score\": null, \"hits\": [] } } ä¸ºä»€ä¹ˆæ²¡æœ‰æŸ¥åˆ°phone 8çš„è¿™ä¸ªæ–‡æ¡£é‚£ï¼Œè¿™é‡Œéœ€è¦ä»‹ç»ä¸€ä¸‹termçš„æŸ¥è¯¢åŸç† â€‹ termæŸ¥è¯¢ä¼šå»å€’æ’ç´¢å¼•ä¸­å¯»æ‰¾ç¡®åˆ‡çš„term,å®ƒå¹¶ä¸ä¼šèµ°åˆ†è¯å™¨ï¼Œåªä¼šå»é…å€’æ’ç´¢å¼• ï¼Œè€Œnameå­—æ®µçš„typeç±»å‹æ˜¯textï¼Œä¼šè¿›è¡Œåˆ†è¯ï¼Œå°†phone 8 åˆ†ä¸ºphoneå’Œ8ï¼Œæˆ‘ä»¬ä½¿ç”¨termæŸ¥è¯¢phone 8æ—¶å€’æ’ç´¢å¼•ä¸­æ²¡æœ‰phone 8ï¼Œæ‰€ä»¥æ²¡æœ‰æŸ¥è¯¢åˆ°åŒ¹é…çš„æ–‡æ¡£ termæŸ¥è¯¢ä¸matchæŸ¥è¯¢çš„åŒºåˆ« termæŸ¥è¯¢æ—¶ï¼Œä¸ä¼šåˆ†è¯ï¼Œç›´æ¥åŒ¹é…å€’æ’ç´¢å¼• matchæŸ¥è¯¢æ—¶ä¼šè¿›è¡Œåˆ†è¯ï¼ŒæŸ¥è¯¢phone 8æ—¶ï¼Œä¼šå…ˆåˆ†è¯æˆphoneå’Œ8ï¼Œç„¶åå»åŒ¹é…å€’æ’ç´¢å¼•ï¼Œæ‰€ä»¥ç»“æœä¼šå°†phone 8å’Œxiaomi 8ä¸¤ä¸ªæ–‡æ¡£éƒ½æŸ¥å‡ºæ¥ è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå› ä¸ºtermæŸ¥è¯¢ä¸ä¼šèµ°åˆ†è¯å™¨ï¼Œä½†æ˜¯å›å»åŒ¹é…å€’æ’ç´¢å¼•ï¼Œæ‰€ä»¥æŸ¥è¯¢çš„ç»“æ„å°±è·Ÿåˆ†è¯å™¨å¦‚ä½•åˆ†è¯æœ‰å…³ç³»ï¼Œæ¯”å¦‚æ–°å¢ä¸€ä¸ª/ad/phoneç±»å‹ä¸‹çš„æ–‡æ¡£ï¼Œnameå­—æ®µèµ‹å€¼ä¸ºOppoï¼Œè¿™æ—¶ä½¿ç”¨termæŸ¥è¯¢Oppoä¸ä¼šæŸ¥è¯¢å‡ºæ–‡æ¡£ï¼Œè¿™æ—¶å› ä¸ºesé»˜è®¤æ˜¯ç”¨çš„standardåˆ†è¯å™¨ï¼Œå®ƒåœ¨åˆ†è¯åä¼šå°†å•è¯è½¬æˆå°å†™è¾“å‡ºï¼Œæ‰€ä»¥ä½¿ç”¨oppoæŸ¥ä¸å‡ºæ–‡æ¡£ï¼Œä½¿ç”¨å°å†™oppoå¯ä»¥æŸ¥å‡ºæ¥ GET /ad/phone/_search { \"query\": { \"term\": { \"name\": { \"value\": \"Oppo\" //æ”¹æˆoppoå¯ä»¥æŸ¥å‡ºæ–°æ·»åŠ çš„æ–‡æ¡£ } } } } è¿™é‡Œè¯´çš„å¹¶ä¸æ˜¯æƒ³è®©ä½ äº†è§£standardåˆ†è¯å™¨ï¼Œè€Œæ˜¯è¦getåˆ°æ‰€æœ‰åƒtermè¿™ç±»çš„æŸ¥è¯¢ç»“æœè·Ÿé€‰æ‹©çš„åˆ†è¯å™¨æœ‰å…³ç³»ï¼Œäº†è§£é€‰æ‹©çš„åˆ†è¯å™¨åˆ†è¯æ–¹å¼æœ‰åŠ©äºæˆ‘ä»¬ç¼–å†™æŸ¥è¯¢è¯­å¥ 3.6. termsæŸ¥è¯¢ termsæŸ¥è¯¢ä¸termæŸ¥è¯¢ä¸€æ ·ï¼Œä½†å®ƒå…è®¸ä½ æŒ‡å®šå¤šç›´è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœè¿™ä¸ªå­—æ®µåŒ…å«äº†æŒ‡å®šå€¼ä¸­çš„ä»»ä½•ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡æ¡£æ»¡è¶³æ¡ä»¶ GET /ad/phone/_search { \"query\": { \"terms\": { \"ad\": [\"red\",\"blue\"] } } } 3.7. exists æŸ¥è¯¢å’Œ missing æŸ¥è¯¢ ç”¨äºæŸ¥æ‰¾é‚£äº›æŒ‡å®šå­—æ®µä¸­æœ‰å€¼ (exists) æˆ–æ— å€¼ (missing) çš„æ–‡æ¡£ æŒ‡å®šnameå­—æ®µæœ‰å€¼ï¼š GET /ad/phone/_search { \"query\": { \"bool\": { \"filter\": { \"exists\": { \"field\": \"name\" } } } } } æŒ‡å®šnameå­—æ®µæ— å€¼ï¼š GET /ad/phone/_search { \"query\": { \"bool\": { \"filter\": { \"missing\": { \"field\": \"name\" } } } } } 3.8. match_phraseæŸ¥è¯¢ çŸ­è¯­æŸ¥è¯¢ï¼Œç²¾ç¡®åŒ¹é…ï¼ŒæŸ¥è¯¢a redä¼šåŒ¹é…adå­—æ®µåŒ…å«a redçŸ­è¯­çš„ï¼Œè€Œä¸ä¼šè¿›è¡Œåˆ†è¯æŸ¥è¯¢ï¼Œä¹Ÿä¸ä¼šæŸ¥è¯¢å‡ºåŒ…å«a å…¶ä»–è¯ redè¿™æ ·çš„æ–‡æ¡£ GET /ad/phone/_search { \"query\": { \"match_phrase\": { \"ad\": \"a red\" } } } 3.9. scrollæŸ¥è¯¢ ç±»ä¼¼äºåˆ†é¡µæŸ¥è¯¢ï¼Œä¸æ”¯æŒè·³é¡µæŸ¥è¯¢ï¼Œåªèƒ½ä¸€é¡µä¸€é¡µå¾€ä¸‹æŸ¥è¯¢ï¼ŒscrollæŸ¥è¯¢ä¸æ˜¯é’ˆå¯¹å®æ—¶ç”¨æˆ·è¯·æ±‚ï¼Œè€Œæ˜¯é’ˆå¯¹å¤„ç†å¤§é‡æ•°æ®ï¼Œä¾‹å¦‚ä¸ºäº†å°†ä¸€ä¸ªç´¢å¼•çš„å†…å®¹é‡æ–°ç´¢å¼•åˆ°å…·æœ‰ä¸åŒé…ç½®çš„æ–°ç´¢å¼•ä¸­ POST /ad/phone/_search?scroll=1m { \"query\": { \"match_all\": {} }, \"size\": 1, \"from\": 0 } è¿”å›å€¼åŒ…å«ä¸€ä¸ª \"_scroll_id\": \"DnF1ZXJ5VGhlbkZldGNoBQAAAAAAAAAQFlV6T3VqY2NaVDBLRG5uZXdiZ0hFYUEAAAAAAAAAERZVek91amNjWlQwS0RubmV3YmdIRWFBAAAAAAAAABIWVXpPdWpjY1pUMEtEbm5ld2JnSEVhQQAAAAAAAAATFlV6T3VqY2NaVDBLRG5uZXdiZ0hFYUEAAAAAAAAAFBZVek91amNjWlQwS0RubmV3YmdIRWFB\" ä¸‹æ¬¡æŸ¥è¯¢çš„æ—¶å€™ä½¿ç”¨_scroll_idå°±å¯ä»¥æŸ¥è¯¢ä¸‹ä¸€é¡µçš„æ–‡æ¡£ POST /_search/scroll { \"scroll\" : \"1m\", \"scroll_id\" : \"DnF1ZXJ5VGhlbkZldGNoBQAAAAAAAAAYFlV6T3VqY2NaVDBLRG5uZXdiZ0hFYUEAAAAAAAAAGRZVek91amNjWlQwS0RubmV3YmdIRWFBAAAAAAAAABYWVXpPdWpjY1pUMEtEbm5ld2JnSEVhQQAAAAAAAAAXFlV6T3VqY2NaVDBLRG5uZXdiZ0hFYUEAAAAAAAAAFRZVek91amNjWlQwS0RubmV3YmdIRWFB\" } 3.10. multi getæŸ¥è¯¢ å…è®¸åŸºäºç´¢å¼•ï¼Œç±»å‹ï¼ˆå¯é€‰ï¼‰å’Œidï¼ˆä»¥åŠå¯èƒ½çš„è·¯ç”±ï¼‰è·å–å¤šä¸ªæ–‡æ¡£ï¼Œå¦‚æœæŸä¸ªæ–‡æ¡£è·å–å¤±è´¥åˆ™å°†é”™è¯¯ä¿¡æ¯åŒ…å«åœ¨å“åº”ä¸­ GET /ad/phone/_mget { \"ids\": [\"1\",\"8\"] } ``` 3.11. bulkæ‰¹é‡æ“ä½œ bulkæ‰¹é‡æ“ä½œå¯ä»¥åœ¨å•æ¬¡APIè°ƒç”¨ä¸­å®ç°å¤šä¸ªæ–‡æ¡£çš„createã€indexã€updateæˆ–deleteã€‚è¿™å¯ä»¥å¤§å¤§æé«˜ç´¢å¼•é€Ÿåº¦ bulkè¯·æ±‚ä½“å¦‚ä¸‹ { action: { metadata }}\\n { request body }\\n { action: { metadata }}\\n { request body }\\n ... actionå¿…é¡»æ˜¯ä»¥ä¸‹å‡ ç§ï¼š è¡Œä¸º è§£é‡Š create å½“æ–‡æ¡£ä¸å­˜åœ¨æ—¶åˆ›å»º index åˆ›å»ºæ–°æ–‡æ¡£æˆ–æ›¿æ¢å·²æœ‰æ–‡æ¡£ update å±€éƒ¨æ›´æ–°æ–‡æ¡£ delete åˆ é™¤ä¸€ä¸ªæ–‡æ¡£ åœ¨ç´¢å¼•ã€åˆ›å»ºã€æ›´æ–°æˆ–åˆ é™¤æ—¶å¿…é¡»æŒ‡å®šæ–‡æ¡£çš„_indexã€_typeã€_idè¿™äº›å…ƒæ•°æ®(metadata) ä¾‹ï¼š PUT _bulk { \"create\" : { \"_index\" : \"ad\", \"_type\" : \"phone\", \"_id\" : \"6\" }} { \"doc\" : {\"name\" : \"bulk\"}} { \"index\" : { \"_index\" : \"ad\", \"_type\" : \"phone\", \"_id\" : \"6\" }} { \"doc\" : {\"name\" : \"bulk\"}} { \"delete\":{ \"_index\" : \"ad\", \"_type\" : \"phone\", \"_id\" : \"1\"}} { \"update\":{ \"_index\" : \"ad\", \"_type\" : \"phone\", \"_id\" : \"3\"}} { \"doc\" : {\"name\" : \"huawei p20\"}} è¿”å›ï¼š { \"took\": 137, \"errors\": true, //å¦‚æœä»»æ„ä¸€ä¸ªæ–‡æ¡£å‡ºé”™ï¼Œè¿™é‡Œè¿”å›true, \"items\": [ //itemsæ•°ç»„ï¼Œå®ƒç½—åˆ—äº†æ¯ä¸€ä¸ªè¯·æ±‚çš„ç»“æœï¼Œç»“æœçš„é¡ºåºä¸æˆ‘ä»¬è¯·æ±‚çš„é¡ºåºç›¸åŒ { //createè¿™ä¸ªæ–‡æ¡£å·²ç»å­˜åœ¨ï¼Œæ‰€ä»¥å¼‚å¸¸ \"create\": { \"_index\": \"ad\", \"_type\": \"phone\", \"_id\": \"6\", \"status\": 409, \"error\": { \"type\": \"version_conflict_engine_exception\", \"reason\": \"[phone][6]: version conflict, document already exists (current version [2])\", \"index_uuid\": \"9F5FHqgISYOra_P09HReVQ\", \"shard\": \"2\", \"index\": \"ad\" } } }, { //indexè¿™ä¸ªæ–‡æ¡£å·²ç»å­˜åœ¨ï¼Œä¼šè¦†ç›– \"index\": { \"_index\": \"ad\", \"_type\": \"phone\", \"_id\": \"6\", \"_version\": 3, \"result\": \"updated\", \"_shards\": { \"total\": 2, \"successful\": 1, \"failed\": 0 }, \"_seq_no\": 6, \"_primary_term\": 5, \"status\": 200 } }, { //åˆ é™¤ \"delete\": { \"_index\": \"ad\", \"_type\": \"phone\", \"_id\": \"1\", \"_version\": 1, \"result\": \"not_found\", \"_shards\": { \"total\": 2, \"successful\": 1, \"failed\": 0 }, \"_seq_no\": 4, \"_primary_term\": 5, \"status\": 404 } }, { //ä¿®æ”¹ \"update\": { \"_index\": \"ad\", \"_type\": \"phone\", \"_id\": \"3\", \"_version\": 3, \"result\": \"noop\", \"_shards\": { \"total\": 2, \"successful\": 1, \"failed\": 0 }, \"status\": 200 } } ] } bulkè¯·æ±‚ä¸æ˜¯åŸå­æ“ä½œï¼Œå®ƒä»¬ä¸èƒ½å®ç°äº‹åŠ¡ã€‚æ¯ä¸ªè¯·æ±‚æ“ä½œæ—¶åˆ†å¼€çš„ï¼Œæ‰€ä»¥æ¯ä¸ªè¯·æ±‚çš„æˆåŠŸä¸å¦ä¸å¹²æ‰°å…¶å®ƒæ“ä½œ 3.12. fuzzyæŸ¥è¯¢ æ¨¡ç³ŠæŸ¥è¯¢ï¼Œfuzzy æŸ¥è¯¢ä¼šè®¡ç®—ä¸å…³é”®è¯çš„æ‹¼å†™ç›¸ä¼¼ç¨‹åº¦ GET /ad/phone/_search { \"query\": { \"fuzzy\": { \"color\":{ \"value\": \"res\" , \"fuzziness\": 2, \"prefix_length\": 1 } } } } å‚æ•°è®¾ç½®ï¼š fuzzinessï¼šæœ€å¤§ç¼–è¾‘è·ç¦»ï¼Œé»˜è®¤ä¸ºAUTO prefix_lengthï¼šä¸ä¼šâ€œæ¨¡ç³ŠåŒ–â€çš„åˆå§‹å­—ç¬¦æ•°ã€‚è¿™æœ‰åŠ©äºå‡å°‘å¿…é¡»æ£€æŸ¥çš„æœ¯è¯­æ•°é‡ï¼Œé»˜è®¤ä¸º0 max_expansionsï¼šfuzzyæŸ¥è¯¢å°†æ‰©å±•åˆ° çš„æœ€å¤§æœ¯è¯­æ•°ã€‚é»˜è®¤ä¸º50ï¼Œè®¾ç½®å°ï¼Œæœ‰åŠ©äºä¼˜åŒ–æŸ¥è¯¢ transpositionsï¼šæ˜¯å¦æ”¯æŒæ¨¡ç³Šè½¬ç½®ï¼ˆabâ†’ baï¼‰ï¼Œé»˜è®¤æ˜¯false 3.13. wildcardæŸ¥è¯¢ æ”¯æŒé€šé…ç¬¦çš„æ¨¡ç³ŠæŸ¥è¯¢ï¼Œï¼ŸåŒ¹é…å•ä¸ªå­—ç¬¦ï¼Œ*åŒ¹é…ä»»ä½•å­—ç¬¦ ä¸ºäº†é˜²æ­¢æå…¶ç¼“æ…¢é€šé…ç¬¦æŸ¥è¯¢ï¼Œ*æˆ–?é€šé…ç¬¦é¡¹ä¸åº”è¯¥æ”¾åœ¨é€šé…ç¬¦çš„å¼€å§‹ GET /ad/phone/_search { \"query\": { \"wildcard\": { \"color\": \"r?d\" } } } console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"},"dao-pai-suo-yin.html":{"url":"dao-pai-suo-yin.html","title":"å€’æ’ç´¢å¼•","keywords":"","body":" å€’æ’ç´¢å¼•1. å€’æ’ç´¢å¼•åŸç† 1.1. Luceneç´¢å¼•æ„æˆ 1.2. Posting List å€’æ’åˆ—è¡¨ 1.3. Term Index è¯é¡¹ç´¢å¼• 1.4. Term Dictionary è¯é¡¹å­—å…¸ 1.5. æ€»ç»“ 2. å¦‚ä½•è”åˆç´¢å¼•æŸ¥è¯¢ 2.1. æŸ¥è¯¢åˆå¹¶ 2.2. Skip List åˆå¹¶ 2.3. bitsetåˆå¹¶ 2.4. å¦‚ä½•å‡å°‘æ–‡æ¡£æ•° å€’æ’ç´¢å¼• 1. å€’æ’ç´¢å¼•åŸç† 1.1. Luceneç´¢å¼•æ„æˆ Luceneç´¢å¼•ç”±ä¸‹é¢ä¸‰éƒ¨åˆ†æ„æˆæ„æˆ 1ï¼‰Term Indexï¼ˆè¯é¡¹ç´¢å¼•ï¼‰ Term Indexæ˜¯ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼Œç”¨äºå¿«é€ŸæŸ¥æ‰¾Term Dictionaryä¸­çš„è¯é¡¹ Term Indexé€šå¸¸æ˜¯ç”¨Trieæ ‘ï¼ˆä¹Ÿç§°ä¸º å‰ç¼€æ ‘ï¼Œå­—å…¸æ ‘ï¼‰å®ç°çš„ åœ¨Trieæ ‘ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå‰ç¼€ï¼‰ï¼Œæ¯æ¡è¾¹ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ä»£è¡¨ä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸² å½“æˆ‘ä»¬æŸ¥æ‰¾ä¸€ä¸ªè¯é¡¹æ—¶ï¼Œå¯ä»¥ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæ²¿ç€è¯é¡¹çš„æ¯ä¸ªå­—ç¬¦å¯¹åº”çš„è¾¹æ‰¾ä¸‹å» ç›´åˆ°æ‰¾åˆ°è¯é¡¹æˆ–ç¡®å®šè¯é¡¹ä¸å­˜åœ¨ 2ï¼‰Term Dictionaryï¼ˆè¯é¡¹å­—å…¸ï¼‰ Term Dictionaryæ˜¯æ‰€æœ‰ç´¢å¼•è¯é¡¹çš„é›†åˆ æ¯ä¸ªè¯é¡¹éƒ½å…³è”ç€ä¸€ä¸ªPosting List è¯é¡¹å­—å…¸ä¸€èˆ¬ä¼šå­˜å‚¨è¯é¡¹çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚è¯é¡¹çš„æ–‡æ¡£é¢‘ç‡ç­‰ 3ï¼‰Posting Listï¼ˆå€’æ’åˆ—è¡¨ï¼‰ Posting Listæ˜¯åŒ…å«äº†æŸä¸ªè¯é¡¹çš„æ‰€æœ‰æ–‡æ¡£çš„IDåˆ—è¡¨ æ¯ä¸ªPosting Listä¸€èˆ¬ä¼šåŒ…å«è¯é¡¹é¢‘ç‡ã€ä½ç½®ä¿¡æ¯ã€åç§»ä¿¡æ¯ æŸ¥æ‰¾è¿‡ç¨‹ åœ¨æ„å»ºç´¢å¼•æ—¶ï¼Œé¦–å…ˆä¼šå¯¹æ–‡æ¡£è¿›è¡Œåˆ†è¯å¤„ç†ï¼Œå¾—åˆ°ä¸€ç³»åˆ—çš„è¯é¡¹ ç„¶åå°†è¿™äº›è¯é¡¹æ·»åŠ åˆ°è¯é¡¹å­—å…¸ä¸­ï¼Œå¹¶æ›´æ–°ç›¸å…³çš„Posting List åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œè¿˜ä¼šæ›´æ–°Term Indexï¼Œä»¥ä¿è¯å¯ä»¥å¿«é€Ÿå®šä½åˆ°è¯é¡¹å­—å…¸ä¸­çš„è¯é¡¹ åœ¨è¿›è¡Œæœç´¢æ—¶ï¼Œé¦–å…ˆä¼šåœ¨Term Indexä¸­æŸ¥æ‰¾è¯é¡¹ ç„¶åé€šè¿‡Term Dictionaryæ‰¾åˆ°å¯¹åº”çš„Posting Listï¼Œä»è€Œæ‰¾åˆ°åŒ…å«è¯¥è¯é¡¹çš„æ‰€æœ‰æ–‡æ¡£ 1.2. Posting List å€’æ’åˆ—è¡¨ [1,2,3]æ˜¯Posting Listï¼ˆå€’æ’åˆ—è¡¨ï¼‰ 0ï¼‰æˆ‘ä»¬æœ‰å¦‚ä¸‹4 æ¡æ–‡æ¡£æ•°æ® æ–‡æ¡£ID æ–‡æ¡£å†…å®¹ 1 äººå·¥æ™ºèƒ½æˆä¸ºäº’è”ç½‘å¤§ä¼šç„¦ç‚¹ 2 è°·æ­Œæ¨å‡ºå¼€æºäººå·¥æ™ºèƒ½ç³»ç»Ÿå·¥å…· 3 äº’è”ç½‘çš„æœªæ¥åœ¨äººå·¥æ™ºèƒ½ 4 è°·æ­Œå¼€æºæœºå™¨å­¦ä¹ å·¥å…· 1ï¼‰åˆ†è¯ å¯¹äºæ–‡æ¡£å†…å®¹ï¼Œå…ˆè¦ç»è¿‡è¯æ¡åŒ–å¤„ç† ä¸è‹±æ–‡ä¸åŒçš„æ˜¯ï¼Œè‹±æ–‡é€šè¿‡ç©ºæ ¼åˆ†éš”å•è¯(ä¸­æ–‡éœ€è¦åˆ†è¯å·¥å…·) ç»è¿‡åˆ†è¯ç³»ç»Ÿè¿›è¡Œä¸­æ–‡åˆ†è¯ä»¥åæŠŠçŸ©é˜µåˆ‡åˆ†æˆä¸€ä¸ªä¸ªçš„è¯æ¡ 2ï¼‰ç»™è¿™äº›documentå»ºç«‹çš„å€’æ’ç´¢å¼•å¦‚ä¸‹ äººå·¥ï¼Œæ™ºèƒ½å«åšTermï¼ˆè¯é¡¹ï¼‰ ESä¼šå°†æ–‡æ¡£çš„å†…å®¹åˆ†è¯ï¼Œæ¯ä¸ªåˆ†è¯å°±æ˜¯ä¸€ä¸ªè¯é¡¹ [1,2,3]æ˜¯Posting Listï¼ˆå€’æ’åˆ—è¡¨ï¼‰ ESä¼šä¸ºæ¯ä¸ªè¯é¡¹å»ºç«‹ä¸€ä¸ª\"Posting Listâ€ å€’æ’åˆ—è¡¨æ˜¯æŒ‡åŒ…å«äº†ä¸€ä¸ªè¯é¡¹çš„æ‰€æœ‰æ–‡æ¡£çš„IDåˆ—è¡¨ ç¬¬ä¸€æ¡\"[1,2,3]\"ï¼Œè¡¨ç¤ºè¯é¡¹â€œäººå·¥â€åœ¨æ–‡æ¡£1,2,3 ä¸­éƒ½å‡ºç°è¿‡ è¯é¡¹ æ–‡æ¡£é¢‘ç‡ å€’æ’è®°å½•è¡¨ äººå·¥ 3 1,2,3 æ™ºèƒ½ 3 1,2,3 æˆä¸º 1 1 äº’è”ç½‘ 2 1,3 å¤§ä¼š 1 1 ç„¦ç‚¹ 1 1 è°·æ­Œ 2 2,4 æ¨å‡º 1 2 1.3. Term Index è¯é¡¹ç´¢å¼• Term Indexæ˜¯ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼Œç”¨äºå¿«é€ŸæŸ¥æ‰¾Term Dictionaryä¸­çš„è¯é¡¹ Term Indexé€šå¸¸æ˜¯ç”¨Trieæ ‘ï¼ˆä¹Ÿç§°ä¸ºå‰ç¼€æ ‘ï¼‰å®ç°çš„ åœ¨Trieæ ‘ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå‰ç¼€ï¼‰ï¼Œæ¯æ¡è¾¹ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ä»£è¡¨ä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸² å½“æˆ‘ä»¬æŸ¥æ‰¾ä¸€ä¸ªè¯é¡¹æ—¶ï¼Œå¯ä»¥ä»æ ¹èŠ‚ç‚¹å¼€å§‹ æ²¿ç€è¯é¡¹çš„æ¯ä¸ªå­—ç¬¦å¯¹åº”çš„è¾¹æ‰¾ä¸‹å»ï¼Œç›´åˆ°æ‰¾åˆ°è¯é¡¹æˆ–ç¡®å®šè¯é¡¹ä¸å­˜åœ¨ ä¸‹é¢æ˜¯ä¸€ä¸ªåŒ…å« \"A\", \"to\", \"tea\", \"ted\", \"ten\", \"i\", \"in\", å’Œ \"inn\" çš„ trie æ ‘ è¿™æ£µæ ‘ä¸ä¼šåŒ…å«æ‰€æœ‰çš„termï¼Œå®ƒåŒ…å«çš„æ˜¯termçš„ä¸€äº›å‰ç¼€ é€šè¿‡term indexå¯ä»¥å¿«é€Ÿåœ°å®šä½åˆ°term dictionaryçš„æŸä¸ªoffsetï¼Œç„¶åä»è¿™ä¸ªä½ç½®å†å¾€åé¡ºåºæŸ¥æ‰¾ å†åŠ ä¸Šä¸€äº›å‹ç¼©æŠ€æœ¯term index çš„å°ºå¯¸å¯ä»¥åªæœ‰æ‰€æœ‰termçš„å°ºå¯¸çš„å‡ ååˆ†ä¹‹ä¸€ ä½¿å¾—ç”¨å†…å­˜ç¼“å­˜æ•´ä¸ªterm indexå˜æˆå¯èƒ½ 1.4. Term Dictionary è¯é¡¹å­—å…¸ Term Dictionaryæ˜¯æ‰€æœ‰ç´¢å¼•è¯é¡¹çš„é›†åˆ æ¯ä¸ªè¯é¡¹éƒ½å…³è”ç€ä¸€ä¸ªPosting List è¯é¡¹å­—å…¸ä¸€èˆ¬ä¼šå­˜å‚¨è¯é¡¹çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚è¯é¡¹çš„æ–‡æ¡£é¢‘ç‡ç­‰ 1.5. æ€»ç»“ 1ï¼‰ä¸ºä»€ä¹ˆ ES æ¯” MySQL å¿« Mysqlåªæœ‰term dictionaryè¿™ä¸€å±‚ï¼Œæ˜¯ä»¥b-treeæ’åºçš„æ–¹å¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ æ£€ç´¢ä¸€ä¸ªterméœ€è¦è‹¥å¹²æ¬¡çš„random accessçš„ç£ç›˜æ“ä½œ è€ŒLuceneåœ¨term dictionaryçš„åŸºç¡€ä¸Šæ·»åŠ äº†term indexæ¥åŠ é€Ÿæ£€ç´¢ï¼Œterm indexä»¥æ ‘çš„å½¢å¼ç¼“å­˜åœ¨å†…å­˜ä¸­ ä»term indexæŸ¥åˆ°å¯¹åº”çš„term dictionaryçš„blockä½ç½®ä¹‹åï¼Œå†å»ç£ç›˜ä¸Šæ‰¾termï¼Œå¤§å¤§å‡å°‘äº†ç£ç›˜çš„random accessæ¬¡æ•° 2ï¼‰FSTï¼ˆfinite state transducersï¼‰ term indexåœ¨å†…å­˜ä¸­æ˜¯ä»¥FSTï¼ˆfinite state transducersï¼‰çš„å½¢å¼ä¿å­˜çš„ï¼Œå…¶ç‰¹ç‚¹æ˜¯éå¸¸èŠ‚çœå†…å­˜ Term dictionaryåœ¨ç£ç›˜ä¸Šæ˜¯ä»¥åˆ†blockçš„æ–¹å¼ä¿å­˜çš„ï¼Œä¸€ä¸ªblockå†…éƒ¨åˆ©ç”¨å…¬å…±å‰ç¼€å‹ç¼© æ¯”å¦‚éƒ½æ˜¯Abå¼€å¤´çš„å•è¯å°±å¯ä»¥æŠŠAbçœå»ã€‚è¿™æ ·term dictionaryå¯ä»¥æ¯”b-treeæ›´èŠ‚çº¦ç£ç›˜ç©ºé—´ 2. å¦‚ä½•è”åˆç´¢å¼•æŸ¥è¯¢ 2.1. æŸ¥è¯¢åˆå¹¶ å¦‚ä½•è¿‡æ»¤ age=18 AND gender=å¥³ çš„æ–‡æ¡£ ç»™å®šæŸ¥è¯¢è¿‡æ»¤æ¡ä»¶ age=18 çš„è¿‡ç¨‹å°±æ˜¯å…ˆä»term indexæ‰¾åˆ°18åœ¨term dictionaryçš„å¤§æ¦‚ä½ç½® ç„¶åå†ä»term dictionaryé‡Œç²¾ç¡®åœ°æ‰¾åˆ°18è¿™ä¸ªtermï¼Œç„¶åå¾—åˆ°ä¸€ä¸ªposting listæˆ–è€…ä¸€ä¸ªæŒ‡å‘posting listä½ç½®çš„æŒ‡é’ˆ ç„¶åå†æŸ¥è¯¢ gender=å¥³ çš„è¿‡ç¨‹ä¹Ÿæ˜¯ç±»ä¼¼çš„ æœ€åå¾—å‡º age=18 AND gender=å¥³ å°±æ˜¯æŠŠä¸¤ä¸ª posting list åšä¸€ä¸ªâ€œä¸â€çš„åˆå¹¶ å¦‚ä½•å°†ä¸¤ä¸ªç´¢å¼•ç»“æ„åˆå¹¶æä¾›äº†ä¸¤ç§æ–¹æ³• ä½¿ç”¨skip listæ•°æ®ç»“æ„ã€‚åŒæ—¶éå†genderå’Œageçš„posting listï¼Œäº’ç›¸skip ä½¿ç”¨bitsetæ•°æ®ç»“æ„ï¼Œå¯¹genderå’Œageä¸¤ä¸ªfilteråˆ†åˆ«æ±‚å‡ºbitsetï¼Œå¯¹ä¸¤ä¸ªbitsetåšANæ“ä½œ 2.2. Skip List åˆå¹¶ ä»¥ä¸Šæ˜¯ä¸‰ä¸ªposting listï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦æŠŠå®ƒä»¬ç”¨ANDçš„å…³ç³»åˆå¹¶ï¼Œå¾—å‡ºposting listçš„äº¤é›† é¦–å…ˆé€‰æ‹©æœ€çŸ­çš„posting listï¼Œç„¶åä»å°åˆ°å¤§éå† éå†çš„è¿‡ç¨‹å¯ä»¥è·³è¿‡ä¸€äº›å…ƒç´ ï¼Œæ¯”å¦‚æˆ‘ä»¬éå†åˆ°ç»¿è‰²çš„13çš„æ—¶å€™ï¼Œå°±å¯ä»¥è·³è¿‡è“è‰²çš„3äº†ï¼Œå› ä¸º3æ¯”13è¦å° æœ€åå¾—å‡ºçš„äº¤é›†æ˜¯[13,98]ï¼Œæ‰€éœ€çš„æ—¶é—´æ¯”å®Œæ•´éå†ä¸‰ä¸ªposting listè¦å¿«å¾—å¤š ä½†æ˜¯å‰ææ˜¯æ¯ä¸ªlistéœ€è¦æŒ‡å‡ºAdvanceè¿™ä¸ªæ“ä½œï¼Œå¿«é€Ÿç§»åŠ¨æŒ‡å‘çš„ä½ç½® 2.3. bitsetåˆå¹¶ # Bitsetæ˜¯ä¸€ç§å¾ˆç›´è§‚çš„æ•°æ®ç»“æ„ï¼Œå¯¹åº”posting listå¦‚ [1,3,4,7,10] # å¯¹åº”çš„bitsetå°±æ˜¯ [1,0,1,1,0,0,1,0,0,1] æ¯ä¸ªæ–‡æ¡£æŒ‰ç…§æ–‡æ¡£idæ’åºå¯¹åº”å…¶ä¸­çš„ä¸€ä¸ªbitï¼ŒBitsetè‡ªèº«å°±æœ‰å‹ç¼©çš„ç‰¹ç‚¹ å…¶ç”¨ä¸€ä¸ªbyteå°±å¯ä»¥ä»£è¡¨8ä¸ªæ–‡æ¡£ï¼Œæ‰€ä»¥100ä¸‡ä¸ªæ–‡æ¡£åªéœ€è¦12.5ä¸‡ä¸ªbyte ä½†æ˜¯è€ƒè™‘åˆ°æ–‡æ¡£å¯èƒ½æœ‰æ•°åäº¿ä¹‹å¤šï¼Œåœ¨å†…å­˜é‡Œä¿å­˜bitsetä»ç„¶æ˜¯å¾ˆå¥¢ä¾ˆçš„äº‹æƒ… è€Œä¸”å¯¹äºä¸ªæ¯ä¸€ä¸ªfilteréƒ½è¦æ¶ˆè€—ä¸€ä¸ªbitsetï¼Œæ¯”å¦‚age=18ç¼“å­˜èµ·æ¥çš„è¯æ˜¯ä¸€ä¸ªbitset 18 æ‰€ä»¥ç§˜è¯€å°±åœ¨äºéœ€è¦æœ‰ä¸€ä¸ªæ•°æ®ç»“æ„ å¯ä»¥å¾ˆå‹ç¼©åœ°ä¿å­˜ä¸Šäº¿ä¸ªbitä»£è¡¨å¯¹åº”çš„æ–‡æ¡£æ˜¯å¦åŒ¹é…filter è¿™ä¸ªå‹ç¼©çš„bitsetä»ç„¶å¯ä»¥å¾ˆå¿«åœ°è¿›è¡ŒANDå’Œ ORçš„é€»è¾‘æ“ä½œ Luceneä½¿ç”¨çš„è¿™ä¸ªæ•°æ®ç»“æ„å«åš Roaring Bitmap å…¶å‹ç¼©çš„æ€è·¯å…¶å®å¾ˆç®€å•ï¼Œä¸å…¶ä¿å­˜100ä¸ª0ï¼Œå ç”¨100ä¸ªbit è¿˜ä¸å¦‚ä¿å­˜0ä¸€æ¬¡ï¼Œç„¶åå£°æ˜è¿™ä¸ª0é‡å¤äº†100é 2.4. å¦‚ä½•å‡å°‘æ–‡æ¡£æ•° ä¸€ç§å¸¸è§çš„å‹ç¼©å­˜å‚¨æ—¶é—´åºåˆ—çš„æ–¹å¼æ˜¯æŠŠå¤šä¸ªæ•°æ®ç‚¹åˆå¹¶æˆä¸€è¡Œ Opentsdbæ”¯æŒæµ·é‡æ•°æ®çš„ä¸€ä¸ªç»æ‹›å°±æ˜¯å®šæœŸæŠŠå¾ˆå¤šè¡Œæ•°æ®åˆå¹¶æˆä¸€è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹å«compaction ç±»ä¼¼çš„vivdcortextä½¿ç”¨mysqlå­˜å‚¨çš„æ—¶å€™ï¼Œä¹ŸæŠŠä¸€åˆ†é’Ÿçš„å¾ˆå¤šæ•°æ®ç‚¹åˆå¹¶å­˜å‚¨åˆ°mysqlçš„ä¸€è¡Œé‡Œä»¥å‡å°‘è¡Œæ•° è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç¤ºä¾‹å¦‚ä¸‹ Elasticsearchæœ‰ä¸€ä¸ªåŠŸèƒ½å¯ä»¥å®ç°ç±»ä¼¼çš„ä¼˜åŒ–æ•ˆæœï¼Œé‚£å°±æ˜¯Nested Document æˆ‘ä»¬å¯ä»¥æŠŠä¸€æ®µæ—¶é—´çš„å¾ˆå¤šä¸ªæ•°æ®ç‚¹æ‰“åŒ…å­˜å‚¨åˆ°ä¸€ä¸ªçˆ¶æ–‡æ¡£é‡Œï¼Œå˜æˆå…¶åµŒå¥—çš„å­æ–‡æ¡£ ç¤ºä¾‹å¦‚ä¸‹ {timestamp:12:05:01, idc:sz, value1:10,value2:11} {timestamp:12:05:02, idc:sz, value1:9,value2:9} {timestamp:12:05:02, idc:sz, value1:18,value:17} å¯ä»¥æ‰“åŒ…æˆ { \"max_timestamp\": \"12:05:02\", \"min_timestamp\": \"1205:01\", \"idc\": \"sz\", \"records\": [ { \"timestamp\": \"12:05:01\", \"value1\": 10, \"value2\": 11 }, { \"timestamp\": \"12:05:02\", \"value1\": 9, \"value2\": 9 }, { \"timestamp\": \"12:05:02\", \"value1\": 18, \"value2\": 17 } ] } è¿™æ ·å¯ä»¥æŠŠæ•°æ®ç‚¹å…¬å…±çš„ç»´åº¦å­—æ®µä¸Šç§»åˆ°çˆ¶æ–‡æ¡£é‡Œï¼Œè€Œä¸ç”¨åœ¨æ¯ä¸ªå­æ–‡æ¡£é‡Œé‡å¤å­˜å‚¨ï¼Œä»è€Œå‡å°‘ç´¢å¼•çš„å°ºå¯¸ å¦‚æœæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªçˆ¶æ–‡æ¡£é‡Œå¡å…¥50ä¸ªåµŒå¥—æ–‡æ¡£ï¼Œé‚£ä¹ˆposting listå¯ä»¥å˜æˆä¹‹å‰çš„1/50 å¯¹äºtermçš„posting liståªéœ€è¦ä¿å­˜çˆ¶æ–‡æ¡£çš„doc idï¼Œæ¯”ä¿å­˜æ‰€æœ‰çš„æ•°æ®ç‚¹çš„doc idè¦å°‘å¾ˆå¤š æŠŠçˆ¶å­å…³ç³»ä¹Ÿç†è§£ä¸ºä¸€ä¸ªfilterï¼Œé‚£ä¹ˆæŸ¥è¯¢æ—¶æ£€ç´¢çš„æ—¶å€™ä¸è¿‡æ˜¯åˆANDäº†å¦å¤–ä¸€ä¸ªfilterè€Œå·² console.log(\"plugin-popup....\");document.onclick = function(e){ e.target.tagName === \"IMG\" && window.open(e.target.src,e.target.src)}img{cursor:pointer}"}}